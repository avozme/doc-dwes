<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>2.4 Interacción con la base de datos - DAW DOCS</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>2.4 Interacción con la base de datos | DAW DOCS</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="2.4 Interacción con la base de datos" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)" /> <meta property="og:description" content="Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)" /> <link rel="canonical" href="/php/interaccion-con-php" /> <meta property="og:url" content="/php/interaccion-con-php" /> <meta property="og:site_name" content="DAW DOCS" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="2.4 Interacción con la base de datos" /> <script type="application/ld+json"> {"@type":"WebPage","url":"/php/interaccion-con-php","headline":"2.4 Interacción con la base de datos","description":"Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> DAW DOCS </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/" class="nav-list-link">Desarrollo Web en Entorno Servidor</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/cms/" class="nav-list-link">1 Sistemas gestores de contenido (CMS)</a><ul class="nav-list"><li class="nav-list-item "> <a href="/cms/algunas-cosas-que-debes-saber" class="nav-list-link">1.1 Algunas cosas que debes saber sobre los CMS</a> </li><li class="nav-list-item "> <a href="/cms/wordpress" class="nav-list-link">1.2 Wordpress</a> </li><li class="nav-list-item "> <a href="/cms/moodle" class="nav-list-link">1.3 Moodle</a> </li><li class="nav-list-item "> <a href="/cms/prestashop" class="nav-list-link">1.4 Prestashop</a> </li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/php/" class="nav-list-link">2 Introducción a PHP</a><ul class="nav-list"><li class="nav-list-item "> <a href="/php/programacion-cliente-servidor" class="nav-list-link">2.1 Programación cliente-servidor</a> </li><li class="nav-list-item "> <a href="/php/caja-de-herramientas" class="nav-list-link">2.2 Caja de herramientas</a> </li><li class="nav-list-item "> <a href="/php/sintaxis-de-php" class="nav-list-link">2.3 Sintaxis de PHP</a> </li><li class="nav-list-item active"> <a href="/php/interaccion-con-php" class="nav-list-link active">2.4 Interacción con la base de datos</a> </li><li class="nav-list-item "> <a href="/php/ejercicios-resueltos" class="nav-list-link">2.5 Ejercicios resueltos</a> </li><li class="nav-list-item "> <a href="/php/ejercicios-propuestos" class="nav-list-link">2.6 Ejercicios propuestos</a> </li></ul></li><li class="nav-list-item "><a href="/cookies-sesiones-seguridad/" class="nav-list-link">3 Cookies, sesiones y seguridad</a></li><li class="nav-list-item "><a href="/mvc/" class="nav-list-link">4 Arquitectura MVC</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/laravel/" class="nav-list-link">5 Laravel</a><ul class="nav-list"><li class="nav-list-item "> <a href="/laravel/1" class="nav-list-link">5.1 Frameworks PHP MVC</a> </li><li class="nav-list-item "> <a href="/laravel/2" class="nav-list-link">5.2 Características de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/3" class="nav-list-link">5.3 Instalación de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/4" class="nav-list-link">5.4 Arquitectura, convenciones y configuración de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/5" class="nav-list-link">5.5 Artisan</a> </li><li class="nav-list-item "> <a href="/laravel/6" class="nav-list-link">5.6 Primeros pasos con Laravel. Hola mundo</a> </li><li class="nav-list-item "> <a href="/laravel/7" class="nav-list-link">5.7 Enrutamiento</a> </li><li class="nav-list-item "> <a href="/laravel/8" class="nav-list-link">5.8 Vistas y plantillas. Blade</a> </li><li class="nav-list-item "> <a href="/laravel/9" class="nav-list-link">5.9 Controladores</a> </li><li class="nav-list-item "> <a href="/laravel/10" class="nav-list-link">5.10 Migraciones</a> </li><li class="nav-list-item "> <a href="/laravel/11" class="nav-list-link">5.11 Usando la BD con Eloquent</a> </li><li class="nav-list-item "> <a href="/laravel/12" class="nav-list-link">5.12 Usando la BD con QueryBuilder</a> </li><li class="nav-list-item "> <a href="/laravel/13" class="nav-list-link">5.13 Sesiones con Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/14" class="nav-list-link">5.14 Helpers de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/15" class="nav-list-link">5.15 Flujo de trabajo típico con Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/16" class="nav-list-link">5.16 Laravel y Vue.js</a> </li><li class="nav-list-item "> <a href="/laravel/17" class="nav-list-link">5.17 Aspectos avanzados de Laravel</a> </li></ul></li><li class="nav-list-item "><a href="/servicios-web/" class="nav-list-link">6 Servicios web</a></li><li class="nav-list-item "><a href="/ajax/" class="nav-list-link">7 Ajax</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/otras-tecnologias/" class="nav-list-link">8 Otras tecnologías</a><ul class="nav-list"><li class="nav-list-item "> <a href="/otros/cgi" class="nav-list-link">8.1 CGI</a> </li><li class="nav-list-item "> <a href="/otros/perl" class="nav-list-link">8.2 Perl</a> </li><li class="nav-list-item "> <a href="/otros/python" class="nav-list-link">8.3 Python</a> </li><li class="nav-list-item "> <a href="/otros/.net" class="nav-list-link">8.4 .NET</a> </li><li class="nav-list-item "> <a href="/otros/jsp" class="nav-list-link">8.5 JSP</a> </li><li class="nav-list-item "> <a href="/otros/ruby" class="nav-list-link">8.6 Ruby</a> </li><li class="nav-list-item "> <a href="/otros/nodejs" class="nav-list-link">8.7 NodeJS</a> </li><li class="nav-list-item "> <a href="/otros/mas-tecnologias-aun" class="nav-list-link">8.8 Más tecnologías aún</a> </li></ul></li><li class="nav-list-item "><a href="/scv-git/" class="nav-list-link">Apéndice I. Sistemas de control de versiones. Git</a></li></ul></li><li class="nav-list-item"><a href="/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search DAW DOCS" aria-label="Search DAW DOCS" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/">Desarrollo Web en Entorno Servidor</a></li> <li class="breadcrumb-nav-list-item"><a href="/php/">2 Introducción a PHP</a></li> <li class="breadcrumb-nav-list-item"><span>2.4 Interacción con la base de datos</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h2 class="no_toc" id="24-interacción-entre-mariadb-y-php"> <a href="#24-interacción-entre-mariadb-y-php" class="anchor-heading" aria-labelledby="24-interacción-entre-mariadb-y-php"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.4. Interacción entre MariaDB y PHP </h2> <ul id="markdown-toc"> <li><a href="#241-mysqlmariadb-con-php4" id="markdown-toc-241-mysqlmariadb-con-php4">2.4.1. MySQL/MariaDB con PHP4</a></li> <li><a href="#242-mysqlmariadb-con-php5" id="markdown-toc-242-mysqlmariadb-con-php5">2.4.2. MySQL/MariaDB con PHP5+</a></li> </ul> <p>A partir de ahora, vamos a referirnos a MySQL/MariaDB indistintamente. Este será el gestor de bases de datos relacionales que vamos a usar a lo largo del curso. La adaptación a otros gestores, en cualquier caso, es muy simple.</p> <p>MySQL/MariaDB, como ya hemos visto, es un SGBD relacional de probada eficacia. La interacción con él resulta eficiente y segura para casi cualquier aplicación web que podamos concebir.</p> <p>Hay básicamente tres métodos de utilizar MySQL/MariaDB:</p> <ul> <li> <p><strong>A través de la línea de comandos:</strong></p> <p>Iniciamos una sesión en MySQL con:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ mysql -h servidor -u nombre_usuario -p
</code></pre></div> </div> <p>Y luego tenemos a nuestra disposición montones de comandos para hacer cosas con la base de datos, incluyendo ejecutar cualquier instrucción válida en SQL.</p> </li> <li> <p><strong>A través de una aplicación con interfaz gráfico</strong>, como PHPMyAdmin, una aplicación web escrita en PHP que proporciona un interfaz muy cómodo para trabajar con MySQL o MariaDB. Si no la conoces, te recomiendo que la uses a partir de ahora porque te la vas a encontrar en casi todos los servidores web.</p> </li> <li> <p><strong>A través de un programa escrito en PHP</strong> o algún otro lenguaje con posibilidad de acceso a MySQL. Este método de acceso será el que nosotros usaremos en nuestros programas para convertirlos en auténticas aplicaciones web.</p> </li> </ul> <p>En esta sección, vamos a ver lo fundamental para usar MySQL desde un programa en PHP. Iremos perfeccionando nuestras habilidades al respecto a lo largo del resto del curso.</p> <h3 id="241-mysqlmariadb-con-php4"> <a href="#241-mysqlmariadb-con-php4" class="anchor-heading" aria-labelledby="241-mysqlmariadb-con-php4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.4.1. MySQL/MariaDB con PHP4 </h3> <p>Si PHP4 está obsoleto, ¿por qué hay un apartado dedicado al acceso a MySQL desde PHP4?</p> <p>Buena pregunta. La respuesta es simple: <span style="color: red"><em>para que sepas lo que <strong>NO</strong> tienes que hacer</em></span>.</p> <p>El hecho es que encontrarás aún mucho código PHP4 pululando por internet. Los sitios donde haya código de ese estilo deben ser evitados. Suele tratarse de blogs antiguos, tutoriales obsoletos o, simplemente, gente ignorante con ganas de ayudar pero que anda bastante perdida.</p> <h4 id="acceso-a-mysql-con-php4-obsoleto"> <a href="#acceso-a-mysql-con-php4-obsoleto" class="anchor-heading" aria-labelledby="acceso-a-mysql-con-php4-obsoleto"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Acceso a MySQL con PHP4 (¡OBSOLETO!) </h4> <p>El modo en que se accedía a bases de datos en PHP4 era mediante <strong>bibliotecas de funciones diferentes para cada SGBD</strong>.</p> <p>Lo digo otra vez: <em>esta forma de programar está obsoleta y se desaconseja su uso</em>. No tiene soporte oficial. Si aparecen problemas de seguridad o estabilidad, nadie los va a resolver. Si encuentras código de este estilo en internet, lárgate de ese sitio, porque no vas a aprender nada útil.</p> <p>PHP4 utilizaba una biblioteca de funciones PHP cuyo nombre empiezaba por las letras <em>mysql_</em>.</p> <p>Por ejemplo, para insertar un registro en una BD MySQL, se hacía así:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="c1">// Conectamos con MySQL</span>
<span class="nb">mysql_connect</span><span class="p">(</span><span class="s2">"URL"</span><span class="p">,</span><span class="s2">"nombre_usuario"</span><span class="p">,</span><span class="s2">"contraseña"</span><span class="p">);</span>

<span class="c1">// Seleccionamos la base de datos con la que vamos a trabajar</span>
<span class="nb">mysql_select_db</span><span class="p">(</span><span class="s2">"nombre_base_de_datos"</span><span class="p">);</span>

<span class="c1">// Ejecutamos una sentencia SQL</span>
<span class="nb">mysql_query</span><span class="p">(</span><span class="s2">"INSERT INTO clientes (nombre,telefono) VALUES ('</span><span class="nv">$nombre</span><span class="s2">','</span><span class="nv">$telefono</span><span class="s2">')"</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <p>Y para ejecutar consultas (SELECT), se hacía más o menos como en este ejemplo. No es necesario que lo entiendas todo. Basta con que te hagas una idea de la manera en la que trabajaba PHP4 para que sepas identificarlo si te lo encuentras por ahí:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="c1">//Nos conectamos con MySQL</span>
<span class="nb">mysql_connect</span><span class="p">(</span><span class="s2">"URL"</span><span class="p">,</span><span class="s2">"user"</span><span class="p">,</span><span class="s2">"password"</span><span class="p">);</span>

<span class="c1">//Seleccionamos la base de datos con la que vamos a trabajar</span>
<span class="nb">mysql_select_db</span><span class="p">(</span><span class="s2">"nombre_base_datos"</span><span class="p">);</span>

<span class="c1">//Ejecutamos la consulta SQL para obtener toda la tabla de Clientes</span>
<span class="nv">$result</span><span class="o">=</span><span class="nb">mysql_query</span><span class="p">(</span><span class="s2">"SELECT * FROM Clientes"</span><span class="p">);</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;table</span> <span class="na">align=</span><span class="s">"center"</span><span class="nt">&gt;&lt;tr&gt;</span>
<span class="nt">&lt;th&gt;</span>Nombre<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>Teléfono<span class="nt">&lt;/th&gt;&lt;/tr&gt;</span>

<span class="cp">&lt;?</span>
<span class="c1">//Mostramos los nombres y teléfonos de los clientes</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$registro</span><span class="o">=</span><span class="nb">mysql_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span> <span class="p">{</span>
<span class="k">echo</span> <span class="s1">'&lt;tr&gt;&lt;td&gt;'</span><span class="mf">.</span><span class="nv">$registro</span><span class="p">[</span><span class="s2">"nombre"</span><span class="p">]</span><span class="mf">.</span><span class="s1">'&lt;/td&gt;'</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">'&lt;td&gt;'</span><span class="mf">.</span><span class="nv">$registro</span><span class="p">[</span><span class="s2">"telefono"</span><span class="p">]</span><span class="mf">.</span><span class="s1">'&lt;/td&gt;&lt;/tr&gt;'</span><span class="p">;</span>
<span class="p">}</span>
<span class="nb">mysql_free_result</span><span class="p">(</span><span class="nv">$result</span><span class="p">)</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div> <h3 id="242-mysqlmariadb-con-php5"> <a href="#242-mysqlmariadb-con-php5" class="anchor-heading" aria-labelledby="242-mysqlmariadb-con-php5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.4.2. MySQL/MariaDB con PHP5+ </h3> <p>Desde PHP5, se utiliza <strong>una biblioteca de clases para acceder a los diferentes SGBDs</strong>.</p> <p>Todos los nuevos desarrollos deberían usar las bibliotecas de clases y prescindir de las viejas librerías de funciones.</p> <p><span style="color: red"><em>Vuelvo a repetirlo: mucho código de ejemplo de PHP que circula por la red es PHP4 y DEBE SER EVITADO.</em></span></p> <h4 id="formas-de-acceder-a-bases-de-datos-en-php"> <a href="#formas-de-acceder-a-bases-de-datos-en-php" class="anchor-heading" aria-labelledby="formas-de-acceder-a-bases-de-datos-en-php"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Formas de acceder a bases de datos en PHP </h4> <p>PHP proporciona varios mecanismos para acceder a bases de datos (ya te lo dije antes: en PHP, casi todo se puede hacer de varias maneras distintas):</p> <ul> <li> <p><strong>Forma 1: Usar la extensión mysqli en su forma procedimental.</strong></p> <p>Esta forma recuerda mucho a PHP4, pero cambiando la palabra “mysql” por “mysqli”.</p> <p>Por ejemplo, la función <em>mysql_connect()</em> ahora se llama <em>mysqli_connect()</em> (la “i” significa “improved”, es decir, “mejorado”).</p> <p>Esta forma es apta para programadores/as perezosos y anticuados, que no quieren pasarse a la programación orientada a objetos y se sienten cómodos con la forma de codificación tradicional. Pero ese no es tu caso, ¿verdad? Así que nunca utilizaremos la forma procedimental.</p> </li> <li> <p><strong>Forma 2: Usar la extensión mysqli en su forma orientada a objetos.</strong></p> <p>Se accede a la base de datos a través de un objeto de la clase <em>mysqli</em>. Es decir, se crea una instancia (con <code class="language-plaintext highlighter-rouge">new mysqli()</code>) y, a través de ella, se tiene acceso a todos los métodos para interactuar con la base de datos.</p> <p>Si en lugar de una base de datos MySQL, trabajamos con otro gestor de base de datos, hay que crear un objeto de otro tipo. Por ejemplo, la clase <em>SQLite3</em> sirve para conectar con bases de datos SQLite. Hay otros gestores que solo ofrecen la forma procedimental.</p> <p>Nosotros, como somos muy modernos, usaremos esta forma de conectar a MySQL durante el resto de este texto.</p> </li> <li> <p><strong>Forma 3: Usar la extensión PDO.</strong></p> <p>A partir de PHP 5.1, existe una clase genérica, llamada <em>PDO</em>, que permite acceder a cualquier gestor de bases de datos mediante el mismo conjunto de métodos. Es lo que se llama una <em>capa de abstracción de acceso a datos</em></p> <p>Esto significa que, independientemente de la base de datos que se esté utilizando, PDO permite utilizar los mismos métodos para realizar consultas y obtener datos, por lo que es una forma de trabajo perfectamente válida y que podríamos haber usado en lugar de la extensión mysqli.</p> </li> </ul> <h4 id="inserción-modificación-y-borrado-de-datos-con-php5"> <a href="#inserción-modificación-y-borrado-de-datos-con-php5" class="anchor-heading" aria-labelledby="inserción-modificación-y-borrado-de-datos-con-php5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Inserción, modificación y borrado de datos con PHP5+ </h4> <p>Vamos a ver cómo funciona la clase <em>mysqli</em> mediante unos cuantos ejemplos. En primer lugar, lanzaremos una inserción de datos.</p> <p>Imagina que tenemos una base de datos MySQL o MariaDB llamada <em>mi-base-de-datos</em> que contiene una tabla de clientes donde guardamos, entre otras cosas, los nombres y los teléfonos de los clientes.</p> <p>Insertar un registro en esa tabla desde PHP se logra en solo dos pasos:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="c1">// Conectamos con el servidor y abrimos la BD</span>
<span class="nv">$conexdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">mysqli</span><span class="p">(</span><span class="s1">'servidor'</span><span class="p">,</span><span class="s1">'nombre-de-usuario'</span><span class="p">,</span><span class="s1">'password'</span><span class="p">,</span><span class="s1">'mi-base-de-datos'</span><span class="p">);</span>

<span class="c1">// Insertamos un registro en una tabla (aquí se podría escribir cualquier sentencia SQL válida)</span>
<span class="nv">$conexdb</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="s2">"INSERT INTO clientes (nombre,telefono) VALUES ('</span><span class="nv">$nombre</span><span class="s2">','</span><span class="nv">$telefono</span><span class="s2">')"</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <p>Si sustituyes la sentencia INSERT por cualquier otra instrucción SQL válida, también funcionará. Con una excepción: SELECT se ejecuta de otra manera que enseguida veremos.</p> <p>Por lo tanto, el código anterior te puede servir de base para ejecutar cualquier INSERT, UPDATE o DELETE sobre tu base de datos. O incluso sentencias de definición de la base de datos, como CREATE TABLE o ALTER TABLE (siempre que el usuario con el que te estés conectando tenga permisos para ejecutarlas, claro)</p> <h4 id="consultas-con-php5"> <a href="#consultas-con-php5" class="anchor-heading" aria-labelledby="consultas-con-php5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Consultas con PHP5+ </h4> <p>Hemos dicho que las sentencias SELECT se lanzan desde PHP de un modo diferente al resto. ¿Por qué será?</p> <p>La respuesta es sencilla de entender: la ejecución de consultas (SELECT) produce la devolución de un conjunto de registros, mientras que cualquier otra instucción (INSERT, UPDATE, DELETE o lo que sea) no devuelve ningún registro.</p> <p>Los registros obtenidos como resultado de un SELECT se manejan en PHP con un objeto denominado <strong>cursor</strong>. Un cursor no es más que un puntero al conjunto de resultados que señala al registro que se va a procesar a continuación.</p> <p>Es decir: se parece al cursor de tu procesador de textos, que te indica el lugar en el que vas a insertar o borrar caracteres.</p> <p>En el caso de los cursores MySQL, no te permiten borrar nada. El cursor solo señala un registro concreto dentro de los resultados del SELECT.</p> <p>Observa cómo se hace un SELECT en este ejemplo:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;body&gt;</span>
<span class="cp">&lt;?php</span>
<span class="c1">//Nos conectamos con MySQL</span>
<span class="nv">$db</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">mysqli</span><span class="p">(</span><span class="s2">"servidor"</span><span class="p">,</span><span class="s2">"user"</span><span class="p">,</span><span class="s2">"password"</span><span class="p">,</span> <span class="s2">"database"</span><span class="p">);</span>

<span class="c1">// Comprobamos que la conexión se ha realizado</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$db</span><span class="o">-&gt;</span><span class="n">connect_error</span><span class="p">){</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">"Error en la conexion : "</span><span class="mf">.</span><span class="nv">$db</span><span class="o">-&gt;</span><span class="n">connect_error</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//Ejecutamos la consulta SQL</span>
<span class="nv">$result</span><span class="o">=</span><span class="nv">$db</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="s2">"SELECT * FROM Clientes"</span><span class="p">);</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;table</span> <span class="na">align=</span><span class="s">"center"</span><span class="nt">&gt;&lt;tr&gt;</span>
   <span class="nt">&lt;th&gt;</span>Nombre<span class="nt">&lt;/th&gt;</span>
   <span class="nt">&lt;th&gt;</span>Teléfono<span class="nt">&lt;/th&gt;&lt;/tr&gt;</span>
<span class="cp">&lt;?</span>
<span class="c1">//Mostramos los registros de SELECT</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$registro</span><span class="o">=</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">fetch_array</span><span class="p">())</span> <span class="p">{</span>
   <span class="k">echo</span> <span class="s1">'&lt;tr&gt;&lt;td&gt;'</span><span class="mf">.</span><span class="nv">$registro</span><span class="p">[</span><span class="s2">"nombre"</span><span class="p">]</span><span class="mf">.</span><span class="s1">'&lt;/td&gt;'</span><span class="p">;</span>
   <span class="k">echo</span> <span class="s1">'&lt;td&gt;'</span><span class="mf">.</span><span class="nv">$registro</span><span class="p">[</span><span class="s2">"telefono"</span><span class="p">]</span><span class="mf">.</span><span class="s1">'&lt;/td&gt;&lt;/tr&gt;'</span><span class="p">;</span>
<span class="p">}</span>
<span class="nv">$db</span><span class="o">-&gt;</span><span class="nf">free</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>  <span class="c1">// Libera memoria usada por cursor</span>
<span class="nv">$db</span><span class="o">-&gt;</span><span class="nf">close</span><span class="p">();</span>   <span class="c1">// Cierra la conexión con el servidor</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div> <p>Probablemente ya lo hayas captado sin necesidad de explicaciones adicionales, pero, por si acaso no es así, ahí va una explicación adicional gratuita.</p> <p>Cuando se lanza una consulta contra una base de datos desde PHP, la base de datos nos devuelve el resultado en un <em>cursor</em>, como hemos dicho. Ese objeto de tipo cursor lo almacenamos en una variable que, en este ejemplo, hemos llamado <em>$result</em>.</p> <p>Recuerda que un cursor es un apuntador a un conjunto de resultados. Cuando un cursor está recién abierto, <em>siempre apunta al primer registro de ese conjunto de resultados</em>.</p> <p>Nuestra variable <em>result</em> es un objeto (su clase se llama <em>mysqli_result</em>, por cierto). Y, como cualquier objeto, contiene una serie de métodos. Entre esos métodos, cualquier cursor siempre nos ofrecerá un método importantísimo llamado <strong><em>fetch()</em></strong> o algo semejante.</p> <p>El método <em>fetch()</em> hace lo siguiente: nos devuelve el siguiente dato almacenado en el cursor (en nuestro caso, un registro completo) y hace avanzar al cursor para que apunte al siguiente dato (en nuestro caso, el siguiente registro). Así, lo deja preparado para recuperar otro registro en la siguiente iteración.</p> <p>Por eso hemos colocado la instrucción <em>fetch()</em> en un bucle. Ahora todo empieza a encajar, ¿verdad?</p> <p>Cuando el cursor está recién abierto, el primer <em>fetch()</em> nos devuelve el primer registro del resultado. Es decir, el primer cliente. Podemos acceder a los campos de ese registro (como “nombre” o “teléfono”) accediendo al registro como si fuera un array ($registro[“nomnre”], $registro[“telefono”], etc). Por eso el método no se llama solo <em>fetch()</em>, sino <em>fetch_array()</em>.</p> <p>Pero <em>fetch()</em> no solo recupera el primer registro, sino que hace avanzar el cursor para que se quede apuntando al segundo. De este modo, en la siguiente iteración del bucle, <em>fetch_array()</em> nos recupera <em>el segundo</em> registro (el segundo cliente), y el cursor queda apuntando al tercero, listo para la siguiente iteración.</p> <p>Cuando no quedan más registros que procesar, <em>fetch()</em> devuelve <em>false</em> y el bucle termina. De ese modo, habremos procesado fácilmente todo el conjunto de resultados devueltos por la consulta.</p> <p>El método <em>fetch()</em> tiene varias formas. Nosotros usaremos sobre todo estas dos:</p> <ul> <li><strong><em>fetch_array()</em></strong>, como en el ejemplo anterior. Cada registro del resultado tiene forma de array. Para acceder, por ejemplo, al nombre de un cliente, escribimos algo como <code class="language-plaintext highlighter-rouge">$registro["nombre"]</code>.</li> <li><strong><em>fetch_object()</em></strong>, que funciona igual, pero cada registro del resultado tiene forma de objeto. Para acceder, por ejemplo, al nombre de un cliente, escribimos algo como <code class="language-plaintext highlighter-rouge">$registro-&gt;nombre</code>.</li> </ul> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
