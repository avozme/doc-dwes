<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>5.12 Usando la BD con QueryBuilder - DAW DOCS</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>5.12 Usando la BD con QueryBuilder | DAW DOCS</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="5.12 Usando la BD con QueryBuilder" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)" /> <meta property="og:description" content="Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)" /> <link rel="canonical" href="/laravel/12" /> <meta property="og:url" content="/laravel/12" /> <meta property="og:site_name" content="DAW DOCS" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="5.12 Usando la BD con QueryBuilder" /> <script type="application/ld+json"> {"@type":"WebPage","url":"/laravel/12","headline":"5.12 Usando la BD con QueryBuilder","description":"Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> DAW DOCS </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/" class="nav-list-link">Desarrollo Web en Entorno Servidor</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/cms/" class="nav-list-link">1 Sistemas gestores de contenido (CMS)</a><ul class="nav-list"><li class="nav-list-item "> <a href="/cms/algunas-cosas-que-debes-saber" class="nav-list-link">1.1 Algunas cosas que debes saber sobre los CMS</a> </li><li class="nav-list-item "> <a href="/cms/wordpress" class="nav-list-link">1.2 Wordpress</a> </li><li class="nav-list-item "> <a href="/cms/moodle" class="nav-list-link">1.3 Moodle</a> </li><li class="nav-list-item "> <a href="/cms/prestashop" class="nav-list-link">1.4 Prestashop</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/php/" class="nav-list-link">2 Introducción a PHP</a><ul class="nav-list"><li class="nav-list-item "> <a href="/php/programacion-cliente-servidor" class="nav-list-link">2.1 Programación cliente-servidor</a> </li><li class="nav-list-item "> <a href="/php/caja-de-herramientas" class="nav-list-link">2.2 Caja de herramientas</a> </li><li class="nav-list-item "> <a href="/php/sintaxis-de-php" class="nav-list-link">2.3 Sintaxis de PHP</a> </li><li class="nav-list-item "> <a href="/php/interaccion-con-php" class="nav-list-link">2.4 Interacción con la base de datos</a> </li><li class="nav-list-item "> <a href="/php/ejercicios-resueltos" class="nav-list-link">2.5 Ejercicios resueltos</a> </li></ul></li><li class="nav-list-item "><a href="/cookies-sesiones-seguridad/" class="nav-list-link">3 Cookies, sesiones y seguridad</a></li><li class="nav-list-item "><a href="/mvc/" class="nav-list-link">4 Arquitectura MVC</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/laravel/" class="nav-list-link">5 Laravel</a><ul class="nav-list"><li class="nav-list-item "> <a href="/laravel/1" class="nav-list-link">5.1 Frameworks PHP MVC</a> </li><li class="nav-list-item "> <a href="/laravel/2" class="nav-list-link">5.2 Características de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/3" class="nav-list-link">5.3 Instalación de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/4" class="nav-list-link">5.4 Arquitectura, convenciones y configuración de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/5" class="nav-list-link">5.5 Artisan</a> </li><li class="nav-list-item "> <a href="/laravel/6" class="nav-list-link">5.6 Primeros pasos con Laravel. Hola mundo</a> </li><li class="nav-list-item "> <a href="/laravel/7" class="nav-list-link">5.7 Enrutamiento</a> </li><li class="nav-list-item "> <a href="/laravel/8" class="nav-list-link">5.8 Vistas y plantillas. Blade</a> </li><li class="nav-list-item "> <a href="/laravel/9" class="nav-list-link">5.9 Controladores</a> </li><li class="nav-list-item "> <a href="/laravel/10" class="nav-list-link">5.10 Migraciones</a> </li><li class="nav-list-item "> <a href="/laravel/11" class="nav-list-link">5.11 Usando la BD con Eloquent</a> </li><li class="nav-list-item active"> <a href="/laravel/12" class="nav-list-link active">5.12 Usando la BD con QueryBuilder</a> </li><li class="nav-list-item "> <a href="/laravel/13" class="nav-list-link">5.13 Sesiones con Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/14" class="nav-list-link">5.14 Helpers de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/15" class="nav-list-link">5.15 Flujo de trabajo típico con Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/16" class="nav-list-link">5.16 Laravel y Vue.js</a> </li><li class="nav-list-item "> <a href="/laravel/17" class="nav-list-link">5.17 Aspectos avanzados de Laravel</a> </li></ul></li><li class="nav-list-item "><a href="/servicios-web/" class="nav-list-link">6 Servicios web</a></li><li class="nav-list-item "><a href="/ajax/" class="nav-list-link">7 Ajax</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/otras-tecnologias/" class="nav-list-link">8 Otras tecnologías</a><ul class="nav-list"><li class="nav-list-item "> <a href="/otros/cgi" class="nav-list-link">8.1 CGI</a> </li><li class="nav-list-item "> <a href="/otros/perl" class="nav-list-link">8.2 Perl</a> </li><li class="nav-list-item "> <a href="/otros/python" class="nav-list-link">8.3 Python</a> </li><li class="nav-list-item "> <a href="/otros/.net" class="nav-list-link">8.4 .NET</a> </li><li class="nav-list-item "> <a href="/otros/jsp" class="nav-list-link">8.5 JSP</a> </li><li class="nav-list-item "> <a href="/otros/ruby" class="nav-list-link">8.6 Ruby</a> </li><li class="nav-list-item "> <a href="/otros/nodejs" class="nav-list-link">8.7 NodeJS</a> </li><li class="nav-list-item "> <a href="/otros/mas-tecnologias-aun" class="nav-list-link">8.8 Más tecnologías aún</a> </li></ul></li><li class="nav-list-item "><a href="/scv-git/" class="nav-list-link">Apéndice I. Sistemas de control de versiones. Git</a></li></ul></li><li class="nav-list-item"><a href="/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search DAW DOCS" aria-label="Search DAW DOCS" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/">Desarrollo Web en Entorno Servidor</a></li> <li class="breadcrumb-nav-list-item"><a href="/laravel/">5 Laravel</a></li> <li class="breadcrumb-nav-list-item"><span>5.12 Usando la BD con QueryBuilder</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h2 id="512-usando-la-bd-con-querybuilder"> <a href="#512-usando-la-bd-con-querybuilder" class="anchor-heading" aria-labelledby="512-usando-la-bd-con-querybuilder"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.12. Usando la BD con QueryBuilder </h2> <h3 id="5121-qué-es-y-cómo-se-utiliza-querybuilder"> <a href="#5121-qué-es-y-cómo-se-utiliza-querybuilder" class="anchor-heading" aria-labelledby="5121-qué-es-y-cómo-se-utiliza-querybuilder"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.12.1. ¿Qué es y cómo se utiliza QueryBuilder? </h3> <p>Eloquent permite usar la BD de forma simple y elegante en la mayor parte de las circunstancias.</p> <p>Aún así, puede haber situaciones en las que queramos un acceso de más bajo nivel a la BD. Para eso existe QueryBuilder.</p> <p>El grado de abstracción de QueryBuilder es mucho menor que el de Eloquent. Es decir, estaremos CASI escribiendo SQL, sin llegar a hacerlo.</p> <p>Algunos ejemplos de uso te darán una pista de qué tipo cosas se pueden hacer con QueryBuilder:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$users</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s2">"users"</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>	
<span class="nv">$users</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s2">"users"</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"="</span><span class="p">,</span> <span class="s2">"Ana"</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">first</span><span class="p">();</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s2">"users"</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s2">"edad"</span><span class="p">,</span> <span class="s2">"&gt;="</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">orderBy</span><span class="p">(</span><span class="s2">"apellidos"</span><span class="p">);</span>
<span class="nv">$maxId</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s2">"users"</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">max</span><span class="p">(</span><span class="s2">"id"</span><span class="p">);</span>
<span class="nv">$existe</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s2">"users"</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"="</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">exists</span><span class="p">();</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s2">"users"</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">select</span><span class="p">(</span><span class="s2">"nombre, apellidos as apell"</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span> 
</code></pre></div></div> <p>En la documentación oficial encontrarás una referencia completa de todas las funciones de QueryBuilder, pero con estas que ves en el ejemplo puedes construir prácticamente cualquier consulta sencilla.</p> <p>El resultado de estas consultas es bastante intuitivo: o bien un dato simple (como el $maxId, que es un entero) o bien un objeto de tipo Collection. Las colecciones de Laravel tienen un montón de métodos útiles para procesarlas y puedes echarle un vistazo a la documentación oficial para ello, pero la mayor parte de las veces basta con hacer un foreach sobre la variable para ir accediendo a cada uno de los elementos, que se comportarán como objetos del tipo adecuado.</p> <p>Por ejemplo, para acceder a todos los registros de la tabla de usuarios:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$users</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s2">"users"</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
   <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="n">email</span><span class="p">;</span>
   <span class="mf">...</span><span class="n">etc</span><span class="mf">...</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="5122-ventajas-de-querybuilder-sobre-sql"> <a href="#5122-ventajas-de-querybuilder-sobre-sql" class="anchor-heading" aria-labelledby="5122-ventajas-de-querybuilder-sobre-sql"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.12.2. Ventajas de QueryBuilder sobre SQL </h3> <p>Como ves, QueryBuilder te permite construir sentencias SQL sin necesidad de escribir SQL. La ventaja de esto es triple:</p> <ol> <li>No tendremos que depurar nuestros errores sintácticos en SQL, con el ahorro de tiempo que eso conlleva.</li> <li>El SQL generado será 100% compatible con el gestor de base de datos que estemos utilizando. Si escribimos SQL en crudo, tendremos que adaptarlo al dialecto de nuestro gestor de base de datos. Y, si cambiamos de gestor, habrá que revisar todas las sentencias SQL para adaptarlas de nuevo. Todo esto lo evita QueryBuilder, puesto que hace esa adaptación por nosotros.</li> <li>Es imposible que suframos un ataque por inyección de SQL, puesto que QueryBuilder no lo permitirá.</li> </ol> <h3 id="5123-relaciones-entre-tablas-con-querybuilder"> <a href="#5123-relaciones-entre-tablas-con-querybuilder" class="anchor-heading" aria-labelledby="5123-relaciones-entre-tablas-con-querybuilder"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.12.3. Relaciones entre tablas con QueryBuilder </h3> <p>Las relaciones entre tablas se manejan con joins, como en SQL, solo que escritos al estilo QueryBuilder.</p> <p>Para hacer un INNER JOIN, puedes usar como referencia este ejemplo:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$users</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nb">join</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">,</span> <span class="s1">'users.id'</span><span class="p">,</span> <span class="s1">'='</span><span class="p">,</span> <span class="s1">'contacts.user_id'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nb">join</span><span class="p">(</span><span class="s1">'orders'</span><span class="p">,</span> <span class="s1">'users.id'</span><span class="p">,</span> <span class="s1">'='</span><span class="p">,</span> <span class="s1">'orders.user_id'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">select</span><span class="p">(</span><span class="s1">'users.*'</span><span class="p">,</span> <span class="s1">'contacts.phone'</span><span class="p">,</span> <span class="s1">'orders.price'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span> 
</code></pre></div></div> <p>Por supuesto, también puedes hacer LEFT JOIN y RIGHT JOIN:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$resultado</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'A'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">leftJoin</span><span class="p">(</span><span class="s1">'B'</span><span class="mf">...</span><span class="p">);</span> 
<span class="nv">$resultado</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'A'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">rightJoin</span><span class="p">(</span><span class="s1">'B'</span><span class="mf">...</span><span class="p">);</span> 
</code></pre></div></div> <h3 id="5123-sql-crudo"> <a href="#5123-sql-crudo" class="anchor-heading" aria-labelledby="5123-sql-crudo"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.12.3. SQL crudo </h3> <p>Por último, QueryBuilder también te permite escribir SQL crudo, si es que alguna vez lo necesitas. Eso sí, deberías valorar muy bien para qué narices quieres escribir SQL crudo. ¿Estás seguro de que eso que intentas hacer no se puede lograr más fácilmente con Eloquent o con QueryBuilder?</p> <p>Además, tendrás que extremar las precauciones ante un posible ataque por inyección de SQL.</p> <p>Si aún así no te he convencido, puedes ejecutar tu SQL así:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$resultado</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">raw</span><span class="p">(</span><span class="s1">'escribe-aquí-tu-sentencia-SQL'</span><span class="p">);</span>
</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
