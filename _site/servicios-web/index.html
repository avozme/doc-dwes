<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>6 Servicios web - DAW DOCS</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>6 Servicios web | DAW DOCS</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="6 Servicios web" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)" /> <meta property="og:description" content="Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)" /> <link rel="canonical" href="/servicios-web/" /> <meta property="og:url" content="/servicios-web/" /> <meta property="og:site_name" content="DAW DOCS" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="6 Servicios web" /> <script type="application/ld+json"> {"@type":"WebPage","url":"/servicios-web/","headline":"6 Servicios web","description":"Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> DAW DOCS </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/" class="nav-list-link">Desarrollo Web en Entorno Servidor</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/cms/" class="nav-list-link">1 Sistemas gestores de contenido (CMS)</a><ul class="nav-list"><li class="nav-list-item "> <a href="/cms/algunas-cosas-que-debes-saber" class="nav-list-link">1.1 Algunas cosas que debes saber sobre los CMS</a> </li><li class="nav-list-item "> <a href="/cms/wordpress" class="nav-list-link">1.2 Wordpress</a> </li><li class="nav-list-item "> <a href="/cms/moodle" class="nav-list-link">1.3 Moodle</a> </li><li class="nav-list-item "> <a href="/cms/prestashop" class="nav-list-link">1.4 Prestashop</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/php/" class="nav-list-link">2 Introducción a PHP</a><ul class="nav-list"><li class="nav-list-item "> <a href="/php/programacion-cliente-servidor" class="nav-list-link">2.1 Programación cliente-servidor</a> </li><li class="nav-list-item "> <a href="/php/caja-de-herramientas" class="nav-list-link">2.2 Caja de herramientas</a> </li><li class="nav-list-item "> <a href="/php/sintaxis-de-php" class="nav-list-link">2.3 Sintaxis de PHP</a> </li><li class="nav-list-item "> <a href="/php/interaccion-con-php" class="nav-list-link">2.4 Interacción con la base de datos</a> </li><li class="nav-list-item "> <a href="/php/ejercicios-resueltos" class="nav-list-link">2.5 Ejercicios resueltos</a> </li></ul></li><li class="nav-list-item "><a href="/cookies-sesiones-seguridad/" class="nav-list-link">3 Cookies, sesiones y seguridad</a></li><li class="nav-list-item "><a href="/mvc/" class="nav-list-link">4 Arquitectura MVC</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/laravel/" class="nav-list-link">5 Laravel</a><ul class="nav-list"><li class="nav-list-item "> <a href="/laravel/1" class="nav-list-link">5.1 Frameworks PHP MVC</a> </li><li class="nav-list-item "> <a href="/laravel/2" class="nav-list-link">5.2 Características de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/3" class="nav-list-link">5.3 Instalación de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/4" class="nav-list-link">5.4 Arquitectura, convenciones y configuración de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/5" class="nav-list-link">5.5 Artisan</a> </li><li class="nav-list-item "> <a href="/laravel/6" class="nav-list-link">5.6 Primeros pasos con Laravel. Hola mundo</a> </li><li class="nav-list-item "> <a href="/laravel/7" class="nav-list-link">5.7 Enrutamiento</a> </li><li class="nav-list-item "> <a href="/laravel/8" class="nav-list-link">5.8 Vistas y plantillas. Blade</a> </li><li class="nav-list-item "> <a href="/laravel/9" class="nav-list-link">5.9 Controladores</a> </li><li class="nav-list-item "> <a href="/laravel/10" class="nav-list-link">5.10 Migraciones</a> </li><li class="nav-list-item "> <a href="/laravel/11" class="nav-list-link">5.11 Usando la BD con Eloquent</a> </li><li class="nav-list-item "> <a href="/laravel/12" class="nav-list-link">5.12 Usando la BD con QueryBuilder</a> </li><li class="nav-list-item "> <a href="/laravel/13" class="nav-list-link">5.13 Sesiones con Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/14" class="nav-list-link">5.14 Helpers de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/15" class="nav-list-link">5.15 Flujo de trabajo típico con Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/16" class="nav-list-link">5.16 Laravel y Vue.js</a> </li><li class="nav-list-item "> <a href="/laravel/17" class="nav-list-link">5.17 Aspectos avanzados de Laravel</a> </li></ul></li><li class="nav-list-item active"><a href="/servicios-web/" class="nav-list-link active">6 Servicios web</a></li><li class="nav-list-item "><a href="/ajax/" class="nav-list-link">7 Ajax</a></li><li class="nav-list-item "><a href="/otras-tecnologias/" class="nav-list-link">8 Otras tecnologías</a></li><li class="nav-list-item "><a href="/scv-git/" class="nav-list-link">Anexo I. Sistemas de control de versiones. Git</a></li></ul></li><li class="nav-list-item"><a href="/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search DAW DOCS" aria-label="Search DAW DOCS" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/">Desarrollo Web en Entorno Servidor</a></li> <li class="breadcrumb-nav-list-item"><span>6 Servicios web</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="6-servicios-web"> <a href="#6-servicios-web" class="anchor-heading" aria-labelledby="6-servicios-web"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6. Servicios web </h1> <h2 id="61-qué-es-un-servicio-web"> <a href="#61-qué-es-un-servicio-web" class="anchor-heading" aria-labelledby="61-qué-es-un-servicio-web"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6.1. ¿Qué es un servicio web? </h2> <p>Como dijimos al estudiar el patrón MVC, esta arquitectura no es la única manera de plantear las aplicaciones web. En este tema vamos a hablar de otra manera en la que las aplicaciones web funcionan muy frecuentemente: como simples servicios.</p> <h3 id="611-una-definición-de-servicio-web"> <a href="#611-una-definición-de-servicio-web" class="anchor-heading" aria-labelledby="611-una-definición-de-servicio-web"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6.1.1. Una definición de servicio web </h3> <p>Un <strong>servicio web</strong> es una forma de permitir que una aplicación cliente y una aplicación servidor se comuniquen entre sí e intercambien información independientemente de la plataforma en la que cada una se ejecute.</p> <p>Los mensajes que las aplicaciones se intercambiar generalmente tienen formato XML o JSON.</p> <p>Hay dos estándares principales en la industria para implementar servicios web: <strong>SOAP</strong> y <strong>REST</strong>.</p> <h3 id="612-diferencias-entre-servicios-web-y-aplicaciones-web"> <a href="#612-diferencias-entre-servicios-web-y-aplicaciones-web" class="anchor-heading" aria-labelledby="612-diferencias-entre-servicios-web-y-aplicaciones-web"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6.1.2. Diferencias entre servicios web y aplicaciones web </h3> <p>Llegados a este punto, puede que estés pensando: “Vale, pero ¿en qué se diferencia todo esto de una aplicación web MVC? ¿No intercambian también el cliente y el servidor información independientemente de la plataforma en la que se ejecuta cada uno?”.</p> <p>Pues sí, pero hay algunas <strong>diferencias fundamentales entre un servicio web y una aplicación web</strong>:</p> <ul> <li>Una aplicación web está diseñada para que un ser humano interactúe con ella a través de un interfaz DHTML. Un servicio web, en cambio, está pensado para que lo use otra aplicación (el cliente), no un ser humano.</li> <li>Por ese motivo, los servicios web carecen de interfaz de usuario y no produce salidas HTML legibles. Es decir, un servicio web <strong>no tiene vistas</strong>.</li> <li>En cambio, los servicios web suelen producir salidas XML o JSON, pensadas para que los clientes las procesen. Una aplicación web solo hace esto cuando responde a una petición Ajax, algo que veremos más adelante.</li> </ul> <p>Por lo demás, un servicio web puede tener una arquitectura <em>aproximadamente</em> MVC, y digo <em>aproximadamente</em> porque el servicio web, como acabo de contarte, carece de vistas. Pero puede seguir conservando sus controladores y sus modelos. Los controladores se encargarán de convertir los datos de los modelos a JSON o XML y devolverlos al cliente.</p> <h2 id="62-soap"> <a href="#62-soap" class="anchor-heading" aria-labelledby="62-soap"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6.2. SOAP </h2> <p><strong>SOAP (Single Object Access Protocol)</strong> es un mecanismo estandarizado para la implementación, descripción y publicación de servicios en red.</p> <p>SOAP establece el modo en el que deben comportarse el cliente y el servidor para hablar entre sí, así como la forma en la que el servidor debe dar a conocer sus servicios.</p> <p>Es un mecanismo orientado al proceso, a diferencia de REST, que está orientado a los datos y que veremos después.</p> <h3 id="621-la-pila-de-protocolos-de-soap"> <a href="#621-la-pila-de-protocolos-de-soap" class="anchor-heading" aria-labelledby="621-la-pila-de-protocolos-de-soap"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6.2.1. La pila de protocolos de SOAP </h3> <p>El estándar SOAP define una serie de protocolos de niveles de abstracción crecientes. Esta colección de protocolos suele denominarse <strong>pila de protocolos SOAP</strong>, y son los siguientes:</p> <p>XXX imagen</p> <p>Vamos a explicar brevemente en qué consiste cada protocolo de la pila, y lo vamos a hacer, como en otras ocasiones, por medio de un ejemplo en lugar de perdernos en largas y farragosas explicaciones.</p> <h3 id="622-los-protocolos-soap-y-wsdl"> <a href="#622-los-protocolos-soap-y-wsdl" class="anchor-heading" aria-labelledby="622-los-protocolos-soap-y-wsdl"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6.2.2. Los protocolos SOAP y WSDL </h3> <p>Para ver cómo funciona el protocolo SOAP (el más importante de la pila de protocolos SOAP, como ya te habrás imaginado por su nombre), utilizaremos tres ejemplos:</p> <ul> <li>En el primero, veremos cómo construir un servidor que duelva colecciones de datos en forma de array.</li> <li>En el segundo, veremos cómo puede un servidor devolver datos con estructura más compleja formateados con JSON.</li> <li>En el tercero, veremos un servidor extremadamente simple con un fichero WSDL.</li> </ul> <h4 id="ejemplo-1-consulta-de-una-bd-de-marcas-y-modelos-de-coches"> <a href="#ejemplo-1-consulta-de-una-bd-de-marcas-y-modelos-de-coches" class="anchor-heading" aria-labelledby="ejemplo-1-consulta-de-una-bd-de-marcas-y-modelos-de-coches"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ejemplo 1: Consulta de una BD de marcas y modelos de coches. </h4> <p>Vamos a programar un servicio web muy sencillo capaz de servir a los clientes que nos lo pidan un listado de las marcas de coches que existen y otro con los modelos registrados que pertenecen a una marca en concreto.</p> <p>El servidor, por lo tanto, necesita dos funciones:</p> <ul> <li>ObtenerMarcas</li> <li>ObtenerModelos($marca)</li> </ul> <p>El cliente, como es lógico, debe conocer cómo utilizar el servidor. Esto puede hacerse mediante el protocolo WSDL (que ya veremos un poco después) por otras vías más tradicionales: documentación de la API, guía del desarrollador, manual de usuario…</p> <p>En estos ejemplos, tanto el servidor como el cliente estarán escritos en PHP. Por supuesto, puede usarse cualquier otro lenguaje para ello, en particular en el lado del cliente. Para saber cómo hacer un cliente SOAP en otros lenguajes, consulta la documentación de tu lenguaje preferido.</p> <p><strong>En el lado del servidor</strong> necesitaremos crear un objeto de tipo SoapServer y definir los métodos a los que el servidor va a responder.</p> <p>Vamos a empezar por los métodos. Crearemos un fichero (por ejemplo, llamado <strong>GestionAutomoviles.class.php</strong>) en cuyo interior escribiremos una clase con los métodos que necesitemos. Para nuestro ejemplo de marcas y modelos de coches, podrías ser algo así:</p> <p>El servidor se crea con una clase que contenga los métodos necesarios:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">GestionAutomoviles</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">ObtenerMarcas</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="nv">$db</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">mysqli</span><span class="p">(</span><span class="o">&lt;</span><span class="n">datos</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">la</span><span class="o">-</span><span class="n">conexión</span><span class="o">&gt;</span><span class="p">);</span>

      <span class="nv">$marcas</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
      <span class="k">if</span><span class="p">(</span> <span class="nv">$db</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="s1">'select id, marca from marcas'</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span> <span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">fetch_array</span><span class="p">()</span> <span class="p">)</span>
          <span class="nv">$marcas</span><span class="p">[</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'marca'</span><span class="p">];</span>
        <span class="nv">$db</span><span class="o">-&gt;</span><span class="nf">close</span><span class="p">();</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nv">$marcas</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="n">ObtenerModelos</span><span class="p">(</span><span class="nv">$marca</span><span class="p">)</span>
    <span class="p">{</span>		
      <span class="nv">$db</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">mysqli</span><span class="p">(</span><span class="o">&lt;</span><span class="n">datos</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">la</span><span class="o">-</span><span class="n">conexión</span><span class="o">&gt;</span><span class="p">);</span>
      <span class="nv">$marca</span> <span class="o">=</span> <span class="nb">intVal</span><span class="p">(</span><span class="nv">$marca</span><span class="p">);</span>
      <span class="nv">$modelos</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

      <span class="k">if</span><span class="p">(</span> <span class="nv">$marca</span> <span class="o">!==</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="s1">'select id, modelo from modelos
                                where marca = '</span> <span class="mf">.</span> <span class="nv">$marca</span> <span class="p">);</span>
        <span class="k">while</span><span class="p">(</span> <span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="nf">fetch_array</span><span class="p">()</span> <span class="p">)</span>
            <span class="nv">$modelos</span><span class="p">[</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'modelo'</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="nv">$db</span><span class="o">-&gt;</span><span class="nf">close</span><span class="p">();</span>
      <span class="k">return</span> <span class="nv">$modelos</span><span class="p">;</span>
    <span class="p">}}</span>
</code></pre></div></div> <p>Ahora, en otro archivo aparte, que llamaremos, por ejemplo, <em>webservice.php</em>, <em>registramos el servicio</em> usando la clase SoapServer de PHP y asignándole la clase anterior GestionAutomoviles. Así:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
   <span class="k">include</span> <span class="s1">'GestionAutomoviles.class.php'</span><span class="p">;</span>
   <span class="nv">$soap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SoapServer</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'uri'</span> <span class="o">=&gt;</span> <span class="s1">'http://localhost/'</span><span class="p">));</span>
   <span class="nv">$soap</span><span class="o">-&gt;</span><span class="nf">setClass</span><span class="p">(</span><span class="s1">'GestionAutomoviles'</span><span class="p">);</span>
   <span class="nv">$soap</span><span class="o">-&gt;</span><span class="nf">handle</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <p>El constructor de SoapServer tiene dos argumentos:</p> <ul> <li>El fichero WSDL donde se describe el servicio. Como aún no vamos a usar fichero WSDL, ese argumento lo dejaremos, de momento, a null.</li> <li>La URL donde el servidor va a estar escuchando. Puede ser el directorio raíz de nuestro servidor o cualquier subdirectorio o archivo.</li> </ul> <p>Por último, y para comprobar que nuestro servidor SOAP funciona bien, necesitamos crear un secillo cliente que consuma ese servicio. Como hemos dicho antes, esta parte también la vamos a programar en PHP, aunque podría hacerse en cualquier otro lenguaje con soporte SOAP.</p> <p><strong>En la parte cliente</strong>, necesitamos crear un objeto de tipo SoapClient:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$soapS</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SoapServer</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s2">"URI del servidor"</span><span class="p">);</span>
</code></pre></div></div> <p>Nuevamente, el primer argumento del constructor es el fichero WSDL. Como aún no trabajamos con ellos, lo dejamos a null. Si tuviéramos fichero WSDL, no necesitaríamos indicar la URI del servidor, porque el propio fichero WSDL lo establecería de forma inequívoca.</p> <p>Una vez hecho eso, podemos consumir los servicios del cliente. Por ejemplo:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
   <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SoapClient</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'uri'</span> <span class="o">=&gt;</span> <span class="s1">'http://localhost/'</span><span class="p">,</span>
       <span class="s1">'location'</span> <span class="o">=&gt;</span> <span class="s1">'http://localhost/&lt;ruta&gt;/webservice.php'</span><span class="p">));</span>
   <span class="nv">$marcas</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="nf">ObtenerMarcas</span><span class="p">();</span>
   <span class="k">foreach</span><span class="p">(</span><span class="nv">$marcas</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span> <span class="p">)</span>
      <span class="k">echo</span> <span class="nv">$value</span><span class="p">;</span>   
<span class="cp">?&gt;</span>
</code></pre></div></div> <p>Observa cómo hemos indicado la localización del servidor: en un array, indicamos su ubicación y la ruta de acceso al fichero que maneja el servicio (en nuestro ejemplo, webservice.php).</p> <h4 id="ejemplo-2-lista-de-libros-de-una-biblioteca"> <a href="#ejemplo-2-lista-de-libros-de-una-biblioteca" class="anchor-heading" aria-labelledby="ejemplo-2-lista-de-libros-de-una-biblioteca"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ejemplo 2: Lista de libros de una biblioteca. </h4> <p>El ejemplo anterior funciona porque tanto cliente como servidor trabajan en PHP. Pero si el cliente no fuera PHP, podría tener problemas al recibir los datos de respuesta del servidor, que son arrays PHP.</p> <p>Lo más adecuado cuando se responden datos complejos es enviarlos en algún formato de intercambio de información, como XML o JSON.</p> <p>En este nuevo ejemplo, vamos a crear un servidor que nos devuelva la lista de libros de una biblioteca (lo que incluirá el id, el título y el ISBN de cada libro) empaquetada en un string JSON.</p> <p>De momento, tampoco usaremos WSDL (fichero de descripción del servicio).</p> <p><strong>Servidor</strong> (archivo <em>libros.class.php</em>):</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">libros</span>
<span class="p">{</span>
      <span class="k">private</span> <span class="k">function</span> <span class="n">getLibrosJSON</span><span class="p">()</span>
      <span class="p">{</span>
         <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT * FROM libros"</span><span class="p">;</span>
         <span class="nv">$db</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">dbAbstract</span><span class="p">();</span>  <span class="c1">// Suponemos que existe una capa</span>
                                  <span class="c1">// de abstracción de datos</span>
         <span class="k">return</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$db</span><span class="o">-&gt;</span><span class="nf">consulta</span><span class="p">(</span><span class="nv">$sql</span><span class="p">));</span>
     <span class="p">}</span>
     <span class="mf">...</span><span class="n">aquí</span> <span class="n">irían</span> <span class="n">más</span> <span class="n">métodos</span> <span class="n">que</span> <span class="n">pudiera</span> <span class="n">tener</span> <span class="n">el</span> <span class="n">servidor</span>
<span class="p">}</span>
     
     
<span class="nc">Registramos</span> <span class="n">el</span> <span class="n">servidor</span> <span class="n">en</span> <span class="n">otro</span> <span class="nf">archivo</span> <span class="p">(</span><span class="n">que</span> <span class="n">llamaremos</span> <span class="o">*</span><span class="n">libros</span><span class="mf">.</span><span class="n">server</span><span class="mf">.</span><span class="n">php</span><span class="o">*</span><span class="p">)</span><span class="o">:</span>

<span class="sb">``</span><span class="err">`</span><span class="n">php</span>
<span class="o">&lt;?</span><span class="n">php</span>
   <span class="k">include</span> <span class="s1">'libros.class.php'</span><span class="p">;</span>
   <span class="nv">$soap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SoapServer</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'uri'</span> <span class="o">=&gt;</span> <span class="s1">'http://localhost/'</span><span class="p">));</span>
   <span class="nv">$soap</span><span class="o">-&gt;</span><span class="nf">setClass</span><span class="p">(</span><span class="s1">'libros'</span><span class="p">);</span>
   <span class="nv">$soap</span><span class="o">-&gt;</span><span class="nf">handle</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <p><strong>Cliente</strong></p> <p>De nuevo, lo vamos a crear en PHP, aunque no sea lo más habitual. Al ser un programa PHP, tendrás que ejecutarlo contra un servidor web, o bien directamente desde la línea de comandos.</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
   <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SoapClient</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'uri'</span> <span class="o">=&gt;</span> <span class="s1">'http://localhost/'</span><span class="p">,</span>
       <span class="s1">'location'</span> <span class="o">=&gt;</span> <span class="s1">'http://localhost/libros.server.php'</span><span class="p">));</span>
   <span class="nv">$listaLibros</span> <span class="o">=</span> <span class="nv">$libros</span><span class="o">-&gt;</span><span class="nf">getLibrosJSON</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <p>A partir de ahí, el cliente dispondrá en $listaLibros de la información recibida del servidor (id, titulo, isbn de todos los libros) empaquetada en formato JSON.</p> <h4 id="ejemplo-3-servicio-de-calculadora"> <a href="#ejemplo-3-servicio-de-calculadora" class="anchor-heading" aria-labelledby="ejemplo-3-servicio-de-calculadora"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ejemplo 3: Servicio de calculadora </h4> <p>Este será un servicio mucho más simple y hasta un poco tontorrón, pero no te lo tomes a mal: solo es un ejemplo.</p> <p>El servicio simple y tontorrón proporcionará dos métodos:</p> <ul> <li>sumar (op1, op2) –&gt; Devuelve la suma de op1 y op2</li> <li>restar (op1, op2) –&gt; Devuelve la diferencia entre op1 y op2</li> </ul> <p>Ahora sí usaremos WSDL para definir el servicio y que los clientes sepan cómo usarlo. Así, a través de un ejemplo simple (y tontorrón) podrás conocer cuál es la estructura de estos ficheros.</p> <p><strong>Servidor</strong></p> <p>El código del servidor es extremadamente simple. Fíjate en que ahora, el crear el objeto SoapServer, sí indicamos el archivo WSDL:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
   <span class="nv">$server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SoapServer</span><span class="p">(</span><span class="s2">"aritmetica.wsdl"</span><span class="p">);</span>
 
   <span class="k">function</span> <span class="n">sumar</span><span class="p">(</span><span class="nv">$operando1</span><span class="p">,</span><span class="nv">$operando2</span><span class="p">){</span>
      <span class="k">return</span> <span class="nv">$operando1</span><span class="o">+</span><span class="nv">$operando2</span><span class="p">;</span>
   <span class="p">}</span>
 
   <span class="k">function</span> <span class="n">restar</span><span class="p">(</span><span class="nv">$operando1</span><span class="p">,</span><span class="nv">$operando2</span><span class="p">){</span>
      <span class="k">return</span> <span class="nv">$operando1</span><span class="o">-</span><span class="nv">$operando2</span><span class="p">;</span>
   <span class="p">}</span>
 
   <span class="nv">$server</span><span class="o">-&gt;</span><span class="nf">AddFunction</span><span class="p">(</span><span class="s2">"sumar"</span><span class="p">);</span>
   <span class="nv">$server</span><span class="o">-&gt;</span><span class="nf">AddFunction</span><span class="p">(</span><span class="s2">"restar"</span><span class="p">);</span>
   <span class="nv">$server</span><span class="o">-&gt;</span><span class="nf">handle</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <p><strong>Cliente</strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
 <span class="nv">$clienteSOAP</span> <span class="o">=</span>
   <span class="k">new</span> <span class="nc">SoapClient</span><span class="p">(</span><span class="s1">'http://ejemplo.com/test/wsdl/aritmetica.wsdl'</span><span class="p">);</span>
 
 <span class="nv">$resultado_suma</span> <span class="o">=</span> <span class="nv">$clienteSOAP</span><span class="o">-&gt;</span><span class="nf">sumar</span><span class="p">(</span><span class="mf">2.7</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">);</span>
 <span class="nv">$resultado_resta</span> <span class="o">=</span> <span class="nv">$clienteSOAP</span><span class="o">-&gt;</span><span class="nf">restar</span><span class="p">(</span><span class="mf">2.7</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">);</span>
 
 <span class="k">echo</span> <span class="s2">"la suma de 2.7 mas 3.5 es: "</span> <span class="mf">.</span> <span class="nv">$resultado_suma</span> <span class="mf">.</span> <span class="s2">"&lt;br/&gt;"</span><span class="p">;</span>
 <span class="k">echo</span> <span class="s2">"la diferencia de 2.7 menos 3.5 es: "</span> <span class="mf">.</span> <span class="nv">$resultado_resta</span> <span class="mf">.</span> <span class="s2">"&lt;br/&gt;"</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <p><strong>Documento WSDL</strong></p> <p>El documento WSDL es un archivo de texto alojado en el servidor donde se describen todos los aspectos del servicio:</p> <ul> <li>Los mensajes que se pueden intercambiar entre el cliente y el servidor.</li> <li>Los argumentos y tipos de datos de esos mensajes.</li> <li>Las operaciones y sus tipos</li> <li>Las rutas donde puede encontrarse el servidor</li> </ul> <p>Se trata de un documento en formato XML que resulta bastante farragoso de leer, así que tómatelo con calma (ahora entiendes por qué hemos elegido un servicio tan simple como el de este ejemplo para ver su archivo WSDL: si usáramos un servicio más realista, el archivo resultaría un monstruo de miles de líneas). Aquí lo tienes:</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;message</span> <span class="na">name=</span><span class="s">"AritmeticaPeticion"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;part</span> <span class="na">name=</span><span class="s">"operando1"</span> <span class="na">type=</span><span class="s">"xsd:float"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;part</span> <span class="na">name=</span><span class="s">"operando2"</span> <span class="na">type=</span><span class="s">"xsd:float"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/message&gt;</span>
 
  <span class="nt">&lt;message</span> <span class="na">name=</span><span class="s">"AritmeticaRespuesta"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;part</span> <span class="na">name=</span><span class="s">"respuesta"</span> <span class="na">type=</span><span class="s">"xsd:float"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/message&gt;</span>

  <span class="nt">&lt;portType</span> <span class="na">name=</span><span class="s">"AritmeticaPort"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;operation</span> <span class="na">name=</span><span class="s">"sumar"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">message=</span><span class="s">"tns:AritmeticaPeticion"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;output</span> <span class="na">message=</span><span class="s">"tns:AritmeticaRespuesta"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/operation&gt;</span>
    <span class="nt">&lt;operation</span> <span class="na">name=</span><span class="s">"restar"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">message=</span><span class="s">"tns:AritmeticaPeticion"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;output</span> <span class="na">message=</span><span class="s">"tns:AritmeticaRespuesta"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/operation&gt;</span>
  <span class="nt">&lt;/portType&gt;</span>

  <span class="nt">&lt;binding</span> <span class="na">name=</span><span class="s">"AritmeticaBinding"</span> <span class="na">type=</span><span class="s">"tns:AritmeticaPort"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;soap:binding</span> <span class="na">style=</span><span class="s">"rpc"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;operation</span> <span class="na">name=</span><span class="s">"sumar"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;soap:operation</span> <span class="na">soapAction=</span><span class="s">"urn:Aritmetica#sumar"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;input&gt;</span>
          <span class="nt">&lt;soap:body</span> <span class="na">use=</span><span class="s">"encoded"</span> <span class="na">namespace=</span><span class="s">"urn:Aritmetica"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/input&gt;</span>
        <span class="nt">&lt;output&gt;</span>
          <span class="nt">&lt;soap:body</span> <span class="na">use=</span><span class="s">"encoded"</span> <span class="na">namespace=</span><span class="s">"urn:Aritmetica"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/output&gt;</span>
    <span class="nt">&lt;/operation&gt;</span>
    <span class="nt">&lt;operation</span> <span class="na">name=</span><span class="s">"restar"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;soap:operation</span> <span class="na">soapAction=</span><span class="s">"urn:Aritmetica#restar"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;input&gt;</span>
          <span class="nt">&lt;soap:body</span> <span class="na">use=</span><span class="s">"encoded"</span> <span class="na">namespace=</span><span class="s">"urn:Aritmetica"</span><span class="nt">/&gt;</span>            		<span class="nt">&lt;/input&gt;</span>
       <span class="nt">&lt;output&gt;</span>
          <span class="nt">&lt;soap:body</span> <span class="na">use=</span><span class="s">"encoded"</span> <span class="na">namespace=</span><span class="s">"urn:Aritmetica"</span><span class="nt">/&gt;</span>                   <span class="nt">&lt;/output&gt;</span>
    <span class="nt">&lt;/operation&gt;</span>
  <span class="nt">&lt;/binding&gt;</span>
  
  <span class="nt">&lt;service</span> <span class="na">name=</span><span class="s">"AritmeticaServicio"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;port</span> <span class="na">name=</span><span class="s">"AritmeticaPort"</span> <span class="na">binding=</span><span class="s">"tns:AritmeticaBinding"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;soap:address</span> <span class="na">location=</span><span class="s">"http://ejemplo.com/test/wsdl/aritmetica_server.php"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/port&gt;</span>
  <span class="nt">&lt;/service&gt;</span>
</code></pre></div></div> <p>Escribir los documentos WSDL a mano es casi imposible. Y hacerlo sin cometer errores, es imposible del todo. Para eso existen herramientas automatizadas que toman el archivo con la clase que contiene los métodos del servicio y generan automáticamente el archivo WSDL.</p> <p>Puedes encontrar estas herramientas de creación automática del archivo WSDL en cualquier IDE avanzado (como Netbeans o Eclipse) y también en mucho sitios web.</p> <p>Por lo tanto, no es un documento que vayas a tener que redactar tú, ni siquiera que leer tú: se trata de una descripción del servicio escrita por y para programas informáticos. Por eso no tiene un formato demasiado legible para un humano.</p> <h3 id="623-uddi"> <a href="#623-uddi" class="anchor-heading" aria-labelledby="623-uddi"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6.2.3. UDDI </h3> <p>Este protocolo, que también forma parte de la pila SOAP, es mucho más fácil de explicar.</p> <p>La explicación es esta: olvídate de él. Fin.</p> <p>Ha sido fácil, ¿no?</p> <p>Por si esta explicación necesita alguna aclaración adicional, te cuento que UDDI fue un intento de la industria por estandarizar repositorios de servicios, de manera que cualquier cliente pudiera lanzar una petición a la red para descubrirlos y usarlos.</p> <p>Imagina que tienes una web que necesita conocer la previsión del tiempo en una zona, la que sea. Puedes localizar un servicio web que te proporcione esa información (ya sea de forma gratuita o mediante una suscripción, eso es irrelevante). Hay, de hecho, muchos servidores que ofrecen este servicio, empezando por el de la Agencia Estatal de Meteorología.</p> <p>Para usar ese servicio, tienes que conocer el servidor que lo ofrece y luego bucear en su API para avieriguar cómo narices debes pedirle la información y en qué formato te la va a devolver. Y, una vez hecho eso, ya estás listo para programar tu cliente y consumir ese servicio.</p> <p>Pues bien: el servicio UDDI buscaba implementar una manera para que el servidor publicara el tipo de servicio que está ofertando y los clientes pudieran escanear la red en busca de esos servicios, para luego seleccionar uno y lanzar peticiones contra él, todo ello de forma más o menos transparente al programador.</p> <p>Era una idea interesante, ¿verdad? Pero murió hace mucho. De hecho, entró en punto muerto en el año 2006, cuando Microsoft e IBM decidieron abandonarlo.</p> <p>Así que, lo dicho: aunque en teoría el protocolo UDDI forma parte de la pila SOAP, puedes actuar como si no existiera.</p> <h2 id="63-rest"> <a href="#63-rest" class="anchor-heading" aria-labelledby="63-rest"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6.3. REST </h2> <p>XXX</p> <p>¿Qué es REST? REST (Representational State Transfer) es un mecanismo de intercambio de información entre clientes y servidores de una red. A diferencia de SOAP, está orientado a los datos, esto eso, proporciona siempre los mismos tipos de acceso a los recursos, sin posibilidad de definir nuevas operaciones. Por esa razón se dice que REST está orientado a los datos mientras que SOAP está orientado a los procesos.</p> <p>Las 7 operaciones REST Un servidor REST (también llamado RESTful) debe implementar estas siete operaciones de acceso a cada tipo de recurso:</p> <p>XXX lista operaciones</p> <p>REST vs SOAP SOAP es más flexible: permite definir nuevas operaciones sobre los recursos, mientras que REST está limitado a las 7 operaciones predefinidas. REST es mucho más sencillo de usar e implementar: las operaciones son bien conocidas y no es necesario describirlas (WSDL) ni publicarlas de ningún modo. Para la mayor parte de las aplicaciones, REST es más que suficiente, y de ahí su mayor implantación en la actualidad.</p> <p>Cómo implementar un servidor RESTful Para implementar un servidor RESTful, basta con: Crear una arquitectura MVC para los recursos/datos que deseemos servir. Con Laravel, esto se puede conseguir con el comando: $ php artisan make:controller –resource <controlador> En lugar de mostrar los recursos en una vista, los mostraremos mediante JSON con un sencillo echo. (Recuerda que esa salida la recibirá el cliente, no un ser humano)</controlador></p> <p>Es importante respetar los nombres de las peticiones HTTP, así como los verbos (GET, POST, etc), puesto que serán los que el cliente utilice.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
