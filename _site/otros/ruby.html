<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>8.6 Ruby - DAW DOCS</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>8.6 Ruby | DAW DOCS</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="8.6 Ruby" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)" /> <meta property="og:description" content="Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)" /> <link rel="canonical" href="/otros/ruby" /> <meta property="og:url" content="/otros/ruby" /> <meta property="og:site_name" content="DAW DOCS" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="8.6 Ruby" /> <script type="application/ld+json"> {"@type":"WebPage","url":"/otros/ruby","headline":"8.6 Ruby","description":"Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> DAW DOCS </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/" class="nav-list-link">Desarrollo Web en Entorno Servidor</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/cms/" class="nav-list-link">1 Sistemas gestores de contenido (CMS)</a><ul class="nav-list"><li class="nav-list-item "> <a href="/cms/algunas-cosas-que-debes-saber" class="nav-list-link">1.1 Algunas cosas que debes saber sobre los CMS</a> </li><li class="nav-list-item "> <a href="/cms/wordpress" class="nav-list-link">1.2 Wordpress</a> </li><li class="nav-list-item "> <a href="/cms/moodle" class="nav-list-link">1.3 Moodle</a> </li><li class="nav-list-item "> <a href="/cms/prestashop" class="nav-list-link">1.4 Prestashop</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/php/" class="nav-list-link">2 Introducción a PHP</a><ul class="nav-list"><li class="nav-list-item "> <a href="/php/programacion-cliente-servidor" class="nav-list-link">2.1 Programación cliente-servidor</a> </li><li class="nav-list-item "> <a href="/php/caja-de-herramientas" class="nav-list-link">2.2 Caja de herramientas</a> </li><li class="nav-list-item "> <a href="/php/sintaxis-de-php" class="nav-list-link">2.3 Sintaxis de PHP</a> </li><li class="nav-list-item "> <a href="/php/interaccion-con-php" class="nav-list-link">2.4 Interacción con la base de datos</a> </li><li class="nav-list-item "> <a href="/php/ejercicios-resueltos" class="nav-list-link">2.5 Ejercicios resueltos</a> </li><li class="nav-list-item "> <a href="/php/ejercicios-propuestos" class="nav-list-link">2.6 Ejercicios propuestos</a> </li></ul></li><li class="nav-list-item "><a href="/cookies-sesiones-seguridad/" class="nav-list-link">3 Cookies, sesiones y seguridad</a></li><li class="nav-list-item "><a href="/mvc/" class="nav-list-link">4 Arquitectura MVC</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/laravel/" class="nav-list-link">5 Laravel</a><ul class="nav-list"><li class="nav-list-item "> <a href="/laravel/1" class="nav-list-link">5.1 Frameworks PHP MVC</a> </li><li class="nav-list-item "> <a href="/laravel/2" class="nav-list-link">5.2 Características de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/3" class="nav-list-link">5.3 Instalación de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/4" class="nav-list-link">5.4 Arquitectura, convenciones y configuración de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/5" class="nav-list-link">5.5 Artisan</a> </li><li class="nav-list-item "> <a href="/laravel/6" class="nav-list-link">5.6 Primeros pasos con Laravel. Hola mundo</a> </li><li class="nav-list-item "> <a href="/laravel/7" class="nav-list-link">5.7 Enrutamiento</a> </li><li class="nav-list-item "> <a href="/laravel/8" class="nav-list-link">5.8 Vistas y plantillas. Blade</a> </li><li class="nav-list-item "> <a href="/laravel/9" class="nav-list-link">5.9 Controladores</a> </li><li class="nav-list-item "> <a href="/laravel/10" class="nav-list-link">5.10 Migraciones</a> </li><li class="nav-list-item "> <a href="/laravel/11" class="nav-list-link">5.11 Usando la BD con Eloquent</a> </li><li class="nav-list-item "> <a href="/laravel/12" class="nav-list-link">5.12 Usando la BD con QueryBuilder</a> </li><li class="nav-list-item "> <a href="/laravel/13" class="nav-list-link">5.13 Sesiones con Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/14" class="nav-list-link">5.14 Helpers de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/15" class="nav-list-link">5.15 Flujo de trabajo típico con Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/16" class="nav-list-link">5.16 Laravel y Vue.js</a> </li><li class="nav-list-item "> <a href="/laravel/17" class="nav-list-link">5.17 Aspectos avanzados de Laravel</a> </li></ul></li><li class="nav-list-item "><a href="/servicios-web/" class="nav-list-link">6 Servicios web</a></li><li class="nav-list-item "><a href="/ajax/" class="nav-list-link">7 Ajax</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/otras-tecnologias/" class="nav-list-link">8 Otras tecnologías</a><ul class="nav-list"><li class="nav-list-item "> <a href="/otros/cgi" class="nav-list-link">8.1 CGI</a> </li><li class="nav-list-item "> <a href="/otros/perl" class="nav-list-link">8.2 Perl</a> </li><li class="nav-list-item "> <a href="/otros/python" class="nav-list-link">8.3 Python</a> </li><li class="nav-list-item "> <a href="/otros/.net" class="nav-list-link">8.4 .NET</a> </li><li class="nav-list-item "> <a href="/otros/jsp" class="nav-list-link">8.5 JSP</a> </li><li class="nav-list-item active"> <a href="/otros/ruby" class="nav-list-link active">8.6 Ruby</a> </li><li class="nav-list-item "> <a href="/otros/nodejs" class="nav-list-link">8.7 NodeJS</a> </li><li class="nav-list-item "> <a href="/otros/mas-tecnologias-aun" class="nav-list-link">8.8 Más tecnologías aún</a> </li></ul></li><li class="nav-list-item "><a href="/scv-git/" class="nav-list-link">Apéndice I. Sistemas de control de versiones. Git</a></li></ul></li><li class="nav-list-item"><a href="/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search DAW DOCS" aria-label="Search DAW DOCS" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/">Desarrollo Web en Entorno Servidor</a></li> <li class="breadcrumb-nav-list-item"><a href="/otras-tecnologias/">8 Otras tecnologías</a></li> <li class="breadcrumb-nav-list-item"><span>8.6 Ruby</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h2 id="86-ruby"> <a href="#86-ruby" class="anchor-heading" aria-labelledby="86-ruby"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.6. Ruby </h2> <h3 id="861-características-del-lenguaje-ruby"> <a href="#861-características-del-lenguaje-ruby" class="anchor-heading" aria-labelledby="861-características-del-lenguaje-ruby"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.6.1. Características del lenguaje Ruby </h3> <p>Fecha de aparición: 1995</p> <p>Perspectivas:</p> <ul> <li>Uso y popularidad creciente.</li> <li>Base de programadores fiel y especializada.</li> <li>Excelente relación señal/ruido.</li> <li>Aún tiene algunos problemas por resolver: El lenguaje todavía está en fase de importantes cambios, tiene peor rendimiento que Python o PHP y muchos módulos (gemas) están mal documentados.</li> </ul> <p>Filosofía:</p> <ul> <li>Completa –y verdaderamente– orientado a objetos. Todo es un objeto.</li> <li>Admite otros paradigmas ocultos bajo los objetos.</li> <li>“Rápido y fácil”. Es un lenguaje divertido: de programadores para programadores.</li> <li>Curva de aprendizaje larga pero nunca abrupta.</li> <li>Potente sistema de expresiones regulares.</li> <li>En combinación con Rails, ideal para desarrollo web MVC rápido y basado en prototipos.</li> </ul> <h4 id="y-ruby-on-rails"> <a href="#y-ruby-on-rails" class="anchor-heading" aria-labelledby="y-ruby-on-rails"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ¿Y Ruby on Rails? </h4> <p>Rails, también conocido como <em>Ruby-on-rails</em>, es un framework para desarrollar aplicaciones web MVC con Ruby.</p> <p>Apareció en 2004 y gustó tanto que otros frameworks para otros lenguajes (como Laravel para PHP) se han inspirado en su forma de trabajar: abundantes capas de abstracción para evitar tareas de bajo nivel, <em>scaffolding</em>, integración con Ajax, <em>Convention over Configuration</em> (CoC) y <em>Don’t Repeat Yourself</em> (DRY).</p> <p>Rails se hizo tan famoso que mucha gente, aún hoy en día, confunde el lenguaje (Ruby) con el framework (Ruby on Rails).</p> <h3 id="862-configuración-necesaria-en-el-servidor"> <a href="#862-configuración-necesaria-en-el-servidor" class="anchor-heading" aria-labelledby="862-configuración-necesaria-en-el-servidor"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.6.2. Configuración necesaria en el servidor </h3> <p>Para poder ejecutar scripts en Ruby en un servidor web Apache o similar, necesitarás:</p> <ul> <li>Instalar el intérprete Ruby en el sistema.</li> <li>Instalar el módulo de Ruby (mod_ruby) y/o el módulo cgi (mod_cgi) para Apache.</li> <li>Configurar el manejador de Apache para CGI.</li> <li>Instalar módulos adicionales para Ruby (como cgi o mysql) si son necesarios.</li> </ul> <p>Como en el caso de Perl o Python, Ruby puede correr de forma nativa en Apache (más rápido pero menos frecuente) o como script CGI.</p> <h3 id="863-sintaxis-básica-de-ruby"> <a href="#863-sintaxis-básica-de-ruby" class="anchor-heading" aria-labelledby="863-sintaxis-básica-de-ruby"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.6.3. Sintaxis básica de Ruby </h3> <p>En Ruby, no es necesario declarar las variables. El tipado es dinámico (tipo <em>duck</em>: si anda como un pato y parece un pato, es que es un pato).</p> <p>Todo es un objeto en este lenguaje, incluso números enteros o los valores constantes, lo cual conduce a expresiones chocantes como estas:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">5</span><span class="p">.</span><span class="nf">isEven?</span>
<span class="s2">"cadena"</span><span class="p">.</span><span class="nf">lenght</span>
<span class="n">variable_cadena</span><span class="p">.</span><span class="nf">chop!</span>
</code></pre></div></div> <p>Ruby está lleno de convenciones para evitar tener que llenar la documentación de explicaciones innecesarias (a esto se le llama “filosofía CoC” = <em>Convention over Configuracion</em>). Por ejemplo:</p> <ul> <li>Es una convención que todos los métodos cuyo nombre termine en una interrogación, deben devolver un booleano. En el ejemplo anterior, el método <em>isEven</em> es uno de ellos.</li> <li>Otra convención es que todos los métodos cuyo nombre termine en una admiración, modificarán irreversiblemente el objeto con el que se invocan. En el ejemplo anterior, el método <em>chop!</em> troceará la cadena cada vez que encuentre un espacio en blanco en su interior, convirtiéndola en un array de cadenas.</li> </ul> <p>Los operadores de Ruby son los habituales:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Comparaci</span><span class="err">ó</span><span class="ss">n: </span><span class="o">==</span><span class="p">,</span> <span class="o">&lt;</span><span class="p">,</span> <span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;=</span><span class="p">,</span> <span class="o">&gt;=</span><span class="p">,</span> <span class="o">=</span><span class="p">,</span> <span class="o">!=</span> 
<span class="no">Asignaci</span><span class="err">ó</span><span class="ss">n: </span><span class="o">=</span>
</code></pre></div></div> <p>Las estructuras de control también te resultarán familiares. No se utilizan llaves ({…}) para marcar los bloques, sino que cada bloque finaliza con la palabra <em>end</em>. El sangrado es optativo pero, por supuesto, muy recomendable.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="n">condicion</span> 
  <span class="no">Acciones</span>
<span class="k">end</span>

<span class="k">if</span> <span class="n">condicion</span>
  <span class="no">Acciones</span><span class="o">-</span><span class="mi">1</span>
<span class="k">else</span> 
  <span class="no">Acciones</span><span class="o">-</span><span class="mi">2</span>
<span class="k">end</span>
</code></pre></div></div> <p>Sin embargo, el uso de bucles clásicos casi siempre puede sustituirse por iteradores sobre objetos, algo cada vez más frecuente en los lenguajes orientados a objetos:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">variable_array</span><span class="p">.</span><span class="nf">do_each</span>
   <span class="o">...</span>
<span class="k">end</span>

<span class="n">num_rows</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span>
   <span class="o">...</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="864-entrada--salida"> <a href="#864-entrada--salida" class="anchor-heading" aria-labelledby="864-entrada--salida"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.6.4. Entrada / Salida </h3> <p>La entrada de datos a través de un formulario HTML se hace usando un objeto de la clase CGI. La salida, con una sencilla sentencia <em>print</em>:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">//</span> <span class="no">Leer</span> <span class="n">datos</span> <span class="n">de</span> <span class="n">un</span> <span class="n">formulario</span>
<span class="nb">require</span> <span class="s2">"cgi"</span>
<span class="n">cgi</span> <span class="o">=</span> <span class="no">CGI</span><span class="p">.</span><span class="nf">new</span>
<span class="n">variable</span> <span class="o">=</span> <span class="n">cgi</span><span class="p">[</span><span class="s2">"campo"</span><span class="p">];</span>

<span class="sr">//</span> <span class="no">Salida</span> <span class="n">de</span> <span class="n">datos</span>
<span class="nb">print</span> <span class="s2">"cadena"</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="s2">"cadena2"</span><span class="p">,</span> <span class="o">...</span> 
</code></pre></div></div> <h3 id="865-bibliotecas-clases-y-métodos"> <a href="#865-bibliotecas-clases-y-métodos" class="anchor-heading" aria-labelledby="865-bibliotecas-clases-y-métodos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.6.5. Bibliotecas, clases y métodos </h3> <p>Las clases en Ruby se declaran de forma muy semejante a Python (observa cómo el símbolo “&lt;” indica herencia):</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="n">nombre_clase</span> <span class="o">&lt;</span> <span class="n">clase</span><span class="o">-</span><span class="n">madre</span>
    <span class="k">def</span> <span class="nf">nombre</span><span class="p">(</span><span class="n">parametros</span><span class="p">)</span>
       <span class="no">Acciones</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Las clases se pueden agrupar en módulos llamados “gemas” (<em>gems</em>). Una gema se puede incluir en nuestro código así:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kp">include</span> <span class="s2">"nombre_gema"</span>
</code></pre></div></div> <h3 id="866-ejemplo-1-en-ruby-hola-mundo"> <a href="#866-ejemplo-1-en-ruby-hola-mundo" class="anchor-heading" aria-labelledby="866-ejemplo-1-en-ruby-hola-mundo"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.6.6. Ejemplo 1 en Ruby: Hola mundo </h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/ruby</span>

<span class="nb">print</span> <span class="s2">"Content-Type: text/html</span><span class="se">\n\n</span><span class="s2">"</span>
<span class="nb">print</span> <span class="s2">"&lt;html&gt;&lt;body&gt;"</span>
<span class="nb">print</span> <span class="s2">"&lt;h1&gt;Hola, mundo&lt;/h1&gt;"</span>
<span class="nb">print</span> <span class="s2">"&lt;/body&gt;&lt;/html&gt;"</span>
</code></pre></div></div> <h3 id="867-ejemplo-2-en-ruby-login-con-comprobación-de-email-por-ajax"> <a href="#867-ejemplo-2-en-ruby-login-con-comprobación-de-email-por-ajax" class="anchor-heading" aria-labelledby="867-ejemplo-2-en-ruby-login-con-comprobación-de-email-por-ajax"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.6.7. Ejemplo 2 en Ruby: login con comprobación de email por Ajax </h3> <p>Una vez más, solo mostraremos el script del lado del servidor (login.rb). Para revisar el código del lado del cliente, puedes acudir a la sección dedicada al lenguaje Perl, y sustituir la referencia al script login.pl por login.rb. El resto del código permanecerá idéntico.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/ruby</span>
<span class="nb">require</span> <span class="s2">"mysql"</span>
<span class="nb">require</span> <span class="s2">"cgi"</span>

<span class="k">begin</span>
    <span class="c1"># Conexión con la base de datos</span>
    <span class="n">con</span> <span class="o">=</span> <span class="no">Mysql</span><span class="p">.</span><span class="nf">new</span> <span class="s1">'server'</span><span class="p">,</span> <span class="s1">'db-user'</span><span class="p">,</span> <span class="s1">'db-password'</span><span class="p">,</span> <span class="s1">'db-name'</span>

    <span class="c1"># Recuperamos la información del formulario HTML</span>
    <span class="n">cgi</span> <span class="o">=</span> <span class="no">CGI</span><span class="p">.</span><span class="nf">new</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="n">cgi</span><span class="p">[</span><span class="s2">"username"</span><span class="p">]</span>
    <span class="n">pass</span> <span class="o">=</span> <span class="n">cgi</span><span class="p">[</span><span class="s2">"password"</span><span class="p">]</span>

    <span class="c1"># Consultamos la base de datos</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">con</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="s2">"SELECT id FROM users WHERE user = '</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">' AND password = '</span><span class="si">#{</span><span class="n">pass</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>

    <span class="c1"># Generamos la salida JSON para el cliente</span>
    <span class="nb">print</span> <span class="s2">"Content-type: application/json</span><span class="se">\n\n</span><span class="s2">"</span>
    <span class="k">if</span> <span class="n">res</span><span class="p">.</span><span class="nf">num_rows</span> <span class="o">==</span> <span class="mi">0</span>
       <span class="nb">print</span> <span class="sx">%Q!{"error": "Username or password not valid"}!</span>
    <span class="k">else</span>
       <span class="n">row</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="nf">fetch_hash</span>
       <span class="nb">print</span> <span class="sx">%Q!{"success": "Authentication is OK", "userid": "</span><span class="si">#{</span><span class="n">row</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span><span class="si">}</span><span class="sx">" }!</span>
    <span class="k">end</span>
    <span class="n">con</span><span class="p">.</span><span class="nf">close</span> <span class="k">if</span> <span class="n">con</span>    
<span class="k">end</span>
</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
