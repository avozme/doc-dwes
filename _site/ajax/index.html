<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>7 Ajax - DAW DOCS</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>7 Ajax | DAW DOCS</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="7 Ajax" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)" /> <meta property="og:description" content="Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)" /> <link rel="canonical" href="/ajax/" /> <meta property="og:url" content="/ajax/" /> <meta property="og:site_name" content="DAW DOCS" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="7 Ajax" /> <script type="application/ld+json"> {"@type":"WebPage","url":"/ajax/","headline":"7 Ajax","description":"Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> DAW DOCS </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/" class="nav-list-link">Desarrollo Web en Entorno Servidor</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/cms/" class="nav-list-link">1 Sistemas gestores de contenido (CMS)</a><ul class="nav-list"><li class="nav-list-item "> <a href="/cms/algunas-cosas-que-debes-saber" class="nav-list-link">1.1 Algunas cosas que debes saber sobre los CMS</a> </li><li class="nav-list-item "> <a href="/cms/wordpress" class="nav-list-link">1.2 Wordpress</a> </li><li class="nav-list-item "> <a href="/cms/moodle" class="nav-list-link">1.3 Moodle</a> </li><li class="nav-list-item "> <a href="/cms/prestashop" class="nav-list-link">1.4 Prestashop</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/php/" class="nav-list-link">2 Introducción a PHP</a><ul class="nav-list"><li class="nav-list-item "> <a href="/php/programacion-cliente-servidor" class="nav-list-link">2.1 Programación cliente-servidor</a> </li><li class="nav-list-item "> <a href="/php/caja-de-herramientas" class="nav-list-link">2.2 Caja de herramientas</a> </li><li class="nav-list-item "> <a href="/php/sintaxis-de-php" class="nav-list-link">2.3 Sintaxis de PHP</a> </li><li class="nav-list-item "> <a href="/php/interaccion-con-php" class="nav-list-link">2.4 Interacción con la base de datos</a> </li><li class="nav-list-item "> <a href="/php/ejercicios-resueltos" class="nav-list-link">2.5 Ejercicios resueltos</a> </li></ul></li><li class="nav-list-item "><a href="/cookies-sesiones-seguridad/" class="nav-list-link">3 Cookies, sesiones y seguridad</a></li><li class="nav-list-item "><a href="/mvc/" class="nav-list-link">4 Arquitectura MVC</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/laravel/" class="nav-list-link">5 Laravel</a><ul class="nav-list"><li class="nav-list-item "> <a href="/laravel/1" class="nav-list-link">5.1 Frameworks PHP MVC</a> </li><li class="nav-list-item "> <a href="/laravel/2" class="nav-list-link">5.2 Características de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/3" class="nav-list-link">5.3 Instalación de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/4" class="nav-list-link">5.4 Arquitectura, convenciones y configuración de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/5" class="nav-list-link">5.5 Artisan</a> </li><li class="nav-list-item "> <a href="/laravel/6" class="nav-list-link">5.6 Primeros pasos con Laravel. Hola mundo</a> </li><li class="nav-list-item "> <a href="/laravel/7" class="nav-list-link">5.7 Enrutamiento</a> </li><li class="nav-list-item "> <a href="/laravel/8" class="nav-list-link">5.8 Vistas y plantillas. Blade</a> </li><li class="nav-list-item "> <a href="/laravel/9" class="nav-list-link">5.9 Controladores</a> </li><li class="nav-list-item "> <a href="/laravel/10" class="nav-list-link">5.10 Migraciones</a> </li><li class="nav-list-item "> <a href="/laravel/11" class="nav-list-link">5.11 Usando la BD con Eloquent</a> </li><li class="nav-list-item "> <a href="/laravel/12" class="nav-list-link">5.12 Usando la BD con QueryBuilder</a> </li><li class="nav-list-item "> <a href="/laravel/13" class="nav-list-link">5.13 Sesiones con Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/14" class="nav-list-link">5.14 Helpers de Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/15" class="nav-list-link">5.15 Flujo de trabajo típico con Laravel</a> </li><li class="nav-list-item "> <a href="/laravel/16" class="nav-list-link">5.16 Laravel y Vue.js</a> </li><li class="nav-list-item "> <a href="/laravel/17" class="nav-list-link">5.17 Aspectos avanzados de Laravel</a> </li></ul></li><li class="nav-list-item "><a href="/servicios-web/" class="nav-list-link">6 Servicios web</a></li><li class="nav-list-item active"><a href="/ajax/" class="nav-list-link active">7 Ajax</a></li><li class="nav-list-item "><a href="/otras-tecnologias/" class="nav-list-link">8 Otras tecnologías</a></li><li class="nav-list-item "><a href="/scv-git/" class="nav-list-link">Anexo I. Sistemas de control de versiones. Git</a></li></ul></li><li class="nav-list-item"><a href="/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search DAW DOCS" aria-label="Search DAW DOCS" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/">Desarrollo Web en Entorno Servidor</a></li> <li class="breadcrumb-nav-list-item"><span>7 Ajax</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="7-ajax"> <a href="#7-ajax" class="anchor-heading" aria-labelledby="7-ajax"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7. Ajax </h1> <h2 id="71-un-poco-de-introducción-al-asunto"> <a href="#71-un-poco-de-introducción-al-asunto" class="anchor-heading" aria-labelledby="71-un-poco-de-introducción-al-asunto"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.1. Un poco de introducción al asunto </h2> <h2 id="711-qué-es-ajax"> <a href="#711-qué-es-ajax" class="anchor-heading" aria-labelledby="711-qué-es-ajax"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.1.1. ¿Qué es Ajax? </h2> <p><strong>Ajax</strong> significa <strong>Asynchronous Javascript And XML</strong>.</p> <p>Qué bien, ¿no?</p> <p>¿Y eso qué quiere decir?</p> <p>Ajax es una tecnología javascript para lanzar y recibir las peticiones al servidor en segundo plano. La página sigue funcionando con normalidad mientras la petición al servidor se resuelve: el usuario puede interactuar con ella y la página responde y no se queda <em>congelada</em> a la espera de que el servidor conteste.</p> <p><strong>Todo eso es lo que significa “de forma asíncrona”</strong>.</p> <p>Esta forma de trabajar, que puede parecer una chorrada, se creó para que las páginas dieran la impresión de ser más ágiles de lo que en realidad eran (sobre todo en una época en la que las redes eran más lentas y los servidores podían tardar bastante en responder).</p> <p>En la actualidad, Ajax ha permitido algo que parecía impensable hace una década: que gran parte de la página se ejecute en el cliente y que se pidan al servidor solo los fragmentos de la página que necesitan ser actualizados. Ajax permite actualizar las páginas sin necesidad de recargarlas por completo, lo que mejora la usabilidad y velocidad de respuesta, y cambia radicalmente nuestra forma de programar una aplicación web.</p> <h3 id="712-ajax-no-sirve-en-realidad-para-nada"> <a href="#712-ajax-no-sirve-en-realidad-para-nada" class="anchor-heading" aria-labelledby="712-ajax-no-sirve-en-realidad-para-nada"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.1.2. Ajax no sirve, en realidad, para nada </h3> <p>Esa es la pura verdad.</p> <p>Puedes programar una aplicación web completa, compleja y profesional sin hacer una sola petición Ajax.</p> <p>Pero Ajax mejora el rendimiento y la experiencia del usuario. Puedes sustituir unas pocas peticiones convencionales por peticiones Ajax sin cambiar demasiado en tu aplicación. Por ejemplo, para borrar un recurso, puedes lanzar la petición DESTROY por Ajax y actualizar tu vista para eliminar el recurso del documento HTML cuando el servidor responda.</p> <p>Esto es fácil de hacer. Y muy recomendable. Te aconsejo empezar a trastear con Ajax de este modo.</p> <h3 id="713-y-sin-embargo-ajax-ha-cambiado-la-forma-en-la-que-desarrollamos-aplicaciones-web"> <a href="#713-y-sin-embargo-ajax-ha-cambiado-la-forma-en-la-que-desarrollamos-aplicaciones-web" class="anchor-heading" aria-labelledby="713-y-sin-embargo-ajax-ha-cambiado-la-forma-en-la-que-desarrollamos-aplicaciones-web"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.1.3. Y, sin embargo, Ajax ha cambiado la forma en la que desarrollamos aplicaciones web </h3> <p>Como algo que, en realidad, no sirve para nada ha logrado cambiar la forma en la que desarrollamos aplicaciones web puede parecer un misterio a simple vista, pero existe una razón muy simple para ello:</p> <p>La mayoría de las aplicaciones web se pasan todo el tiempo haciendo lo mismo: accediendo a recursos de una base de datos para consultarlos, crearlos, modificarlos o borrarlos, todo ello mediante un interfaces de usuario básicamente semejantes. Es decir, el interfaz de usuario para crear, modificar y borrar productos de una base de datos es prácticamente el mismo que el que se usa para crear, modificar y borrar proveedores, por decir algo.</p> <p>Así que alguien se preguntó: ¿por qué estamos programando todo el tiempo lo mismo?</p> <p>Ajax nos permite hacer algo muy ingenioso para evitar este engorro: diseñar un interfaz de usuario genérico y vacío, solo compuesto por contenedores preparados para nutrirse de datos del servidor.</p> <p>Por ejemplo, podemos diseñar un típico interfaz de usuario HTML que nos muestre una lista de recursos (productos, proveedores, o lo que sea) junto con los botones de “Update” y “Delete”, además de un botón de “Add new”. Pero ese interfaz estará vacío, y mediante Ajax lo cargaremos con productos, con proveedores o con lo que necesitemos. Crearemos el interfaz una vez y lo podemos reutilizar miles de veces, para todo tipo de recursos.</p> <p>Este tipo de aplicaciones, también llamadas <strong>SPA (Single-page applications)</strong>, necesitan una arquitectura algo distinta de la que usamos en las aplicaciones web tradicionales, además de una librería en el lado del cliente para ayudarnos en la creación de contenedores genéricos (librerías como <strong>Angular</strong>, <strong>React</strong> o <strong>Vue.js</strong>). Aunque excede a nuestros propósitos profundizar en estas librerías, hemos visto algunos fundamentos sobre el uso de Vue.js con Laravel en el capítulo dedicado a Laravel. Consútalo si quieres profundizar en esta forma de uso masivo de Ajax.</p> <p>En lo que sigue de este capítulo, utilizaremos Ajax de forma puntual en el entorno de una aplicación web convencional con arquitectura MVC.</p> <h2 id="72-cómo-enviar-peticiones-ajax-al-servidor"> <a href="#72-cómo-enviar-peticiones-ajax-al-servidor" class="anchor-heading" aria-labelledby="72-cómo-enviar-peticiones-ajax-al-servidor"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.2. Cómo enviar peticiones Ajax al servidor </h2> <h3 id="721-peticiones-sin-datos-al-servidor"> <a href="#721-peticiones-sin-datos-al-servidor" class="anchor-heading" aria-labelledby="721-peticiones-sin-datos-al-servidor"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.2.1. Peticiones sin datos al servidor </h3> <p>La forma más sencilla (y primitiva) de usar Ajax es lanzar una petición asíncrona al servidor sin que el usuario de la web se percate de ello (porque se hará en segundo plano). El servidor no sabrá si la petición se lanzó en primer o en segundo plano y, en realidad, no le importa: él se limitará a atender la petición.</p> <p>Para lanzar una petición mediante Ajax usando JavaScript tradicional (luego veremos cómo hacerlo con jQuery, que simplifica bastante el proceso), necesitamos crear un objeto de tipo XMLHttpRequest. Este objeto nos permitirá controlar todo el proceso de envío de la petición, recepción de la posible respuesta y control de los errores que hayan podido ocurrir.</p> <p>Observa detenidamente este fragmento de código JavaScript:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">peticion_http</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">peticion_http</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="nx">procesa_respuesta</span><span class="p">;</span>
<span class="nx">peticion_http</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">http://servidor/recurso</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">peticion_http</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>


<span class="kd">function</span> <span class="nx">procesa_respuesta</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">peticion_http</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">peticion_http</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">peticion_http</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>En las cuatro primeras líneas se crea el objeto de tipo XMLHttpRequest y luego se hacen tres cosas clave con él:</p> <ol> <li>Se le indica qué función se debe ejecutar cuando el servidor responda. Recuerda que esta función se ejecutará también en segundo plano, sin que el usuario de la página se percate de que está sucediendo algo.</li> <li>Se le indica qué recurso del servidor se quiere invocar (típicamente, una URL). Para ello se usa el método open(). Ahí también se indica el método de envío de datos al servidor (GET o POST), incluso si no se envían datos al servidor en absoluto, como en este ejemplo.</li> <li>Por último, se lanza la petición al servidor con el método send(). El argumento “null” debe sustituirse por los datos que se envían al servidor mediante GET en caso de que los hubiera.</li> </ol> <p>Eso deja lista la petición. JavaScript permanecerá a la escucha en segundo plano hasta que el servidor responda. Cuando lo haga, se ejecutará la función procesa_respuesta().</p> <p>En esa función se hacen tres cosas muy importantes: XXX</p> <h3 id="722-peticiones-con-datos-al-servidor-get"> <a href="#722-peticiones-con-datos-al-servidor-get" class="anchor-heading" aria-labelledby="722-peticiones-con-datos-al-servidor-get"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.2.2. Peticiones con datos al servidor (GET) </h3> <p>var cp = document.getElementById(“codigo_postal”); var telefono = document.getElementById(“telefono”);</p> <p>query_string = “&amp;codigo_postal=” + encodeURIComponent(cp.value) + “&amp;telefono=” + encodeURIComponent(telefono.value);</p> <p>peticion_http = new XMLHttpRequest(); peticion_http.onreadystatechange = procesa_respuesta; peticion_http.open(‘GET’, ‘http://servidor/scrip.php’, true); peticion_http.send(query_string);</p> <p>function procesa_respuesta() { …. }</p> <h3 id="723-peticiones-con-datos-al-servidor-post"> <a href="#723-peticiones-con-datos-al-servidor-post" class="anchor-heading" aria-labelledby="723-peticiones-con-datos-al-servidor-post"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.2.3. Peticiones con datos al servidor (POST) </h3> <p>var cp = document.getElementById(“codigo_postal”); var telefono = document.getElementById(“telefono”);</p> <p>query_string = “&amp;codigo_postal=” + encodeURIComponent(cp.value) + “&amp;telefono=” + encodeURIComponent(telefono.value);</p> <p>peticion_http = new XMLHttpRequest(); peticion_http.onreadystatechange = procesa_respuesta; peticion_http.open(“POST”, “http://servidor/script.php”, true); peticion_http.setRequestHeader(“Content-Type”, “application/x-www-form-urlencoded”); peticion_http.send(query_string);</p> <p>function procesa_respuesta() { …. }</p> <h3 id="724-peticiones-con-datos-al-servidor-xml"> <a href="#724-peticiones-con-datos-al-servidor-xml" class="anchor-heading" aria-labelledby="724-peticiones-con-datos-al-servidor-xml"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.2.4. Peticiones con datos al servidor (XML) </h3> <p>var cp = document.getElementById(“codigo_postal”); var telefono = document.getElementById(“telefono”); xml = “<datos>" + "<cp>" + cp + </cp>" + <telefono> + telefono + </telefono> + "</datos>”;</p> <p>peticion_http = new XMLHttpRequest(); peticion_http.onreadystatechange = procesa_respuesta; peticion_http.open(“POST”, “http://servidor/script.php”, true); peticion_http.setRequestHeader(“Content-Type”, “application/x-www-form-urlencoded”); peticion_http.send(xml);</p> <p>function procesa_respuesta() { …. }</p> <h2 id="73-cómo-recibir-la-respuesta-del-servidor"> <a href="#73-cómo-recibir-la-respuesta-del-servidor" class="anchor-heading" aria-labelledby="73-cómo-recibir-la-respuesta-del-servidor"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.3. Cómo recibir la respuesta del servidor </h2> <h3 id="731-recepción-de-datos-xml"> <a href="#731-recepción-de-datos-xml" class="anchor-heading" aria-labelledby="731-recepción-de-datos-xml"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.3.1. Recepción de datos XML </h3> <p>Recepción de datos XML function procesaRespuesta() { if(peticion_http.readyState == 4) { if(peticion_http.status == 200) { var xml = peticion_http.responseXML; var datos = xml.getElementsByTagName(“datos”)[0]; var telefono = datos.getElementsByTagName(“telefono”)[0]. firstChild.nodeValue; var cp = datos.getElementsByTagName(“cp”)[0]. firstChild.nodeValue;</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  document.getElementById("respuesta").innerHTML = 
         "Codigo postal = " + codigo_postal + "&lt;br/&gt;" + 
         "Telefono = " + telefono;
}   } }
</code></pre></div></div> <h3 id="732-recepción-de-datos-json"> <a href="#732-recepción-de-datos-json" class="anchor-heading" aria-labelledby="732-recepción-de-datos-json"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.3.2. Recepción de datos JSON </h3> <p>function procesaRespuesta() { if(http_request.readyState == 4) { if(http_request.status == 200) { var json = http_request.responseText; var objeto_json = eval(“(“+json+”)”); var telefono = objeto_json.datos.telefono; var codigo_postal = objeto_json.datos.cp; document.getElementById(“respuesta”).innerHTML = “Codigo postal = “ + codigo_postal + “<br />” + “Telefono = “ + telefono; } } }</p> <h2 id="74-ajax-y-jquery"> <a href="#74-ajax-y-jquery" class="anchor-heading" aria-labelledby="74-ajax-y-jquery"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.4. Ajax y jQuery </h2> <p>El uso de jQuery facilita enormemente la programación de llamadas Ajax al servidor. jQuery ofrece varias funciones para hacer llamadas Ajax: $.ajax() → La más configurable pero también la más compleja. $.get() → Para lanzar peticiones GET sencillas. $.post() → Para lanzar peticiones POST sencillas $.load() → Para lanzar peticiones GET y cargar la respuesta en una capa.</p> <p>Función $.ajax() $.ajax({ url: ‘/ruta/hasta/script.php’, type: ‘POST’, async: true, data: ‘parametro1=valor1&amp;parametro2=valor2’, success: función_procesa_respuesta, error: función_procesa_error });</p> <p>Funciones $.get() y $.post $.get(url, datos, funcion_manejadora); $.post(url, datos, funcion_manejadora);</p> <p>Ejemplo: $.get(‘/ruta/hasta/script.php’, { user: ‘juanperez03’ }, function(user) { alert(‘Hola, ‘ + user); } );</p> <p>Función $.load() Inserta el resultado del script del servidor en el elemento seleccionado con $: $(‘#info’).load(‘/ruta/hasta/pagina.php’);</p> <p>Variación “IfModified”:</p> <p>$.getIfModified(‘/ruta/hasta/script.php’); $.postIfModified(‘/ruta/hasta/script.php’); $(‘#info’).loadIfModified(‘/ruta/hasta/script.php’);</p> <h2 id="75-ajax-y-laravel"> <a href="#75-ajax-y-laravel" class="anchor-heading" aria-labelledby="75-ajax-y-laravel"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.5. Ajax y Laravel </h2> <p>Enrutador /routes/web.php Route::post(‘miJqueryAjax’,’AjaxController@miMetodo’);</p> <p>Ten en cuenta que: No es imprescindible crear un controlador específico para atender las peticiones Ajax. Puedes usar métodos de tus controladores habituales. Las peticiones Ajax pueden llegar por GET, POST o cualquier otro método. De hecho, el servidor no tiene modo de saber si han llegado por Ajax o no.</p> <p>Controlador /app/controllers/AjaxController.php class AjaxController extends Controller { public function miMetodo() { …aquí va mi código… $result = json_encode($mis_variables); echo $result; } }</p> <p>O mejor todavía: class AjaxController extends Controller { public function miMetodo() { $msg = “This is a simple message.”; return response()-&gt;json($mis_variables); } }</p> <p>Ten en cuenta que: La salida de una petición Ajax suele ser JSON, pero podría ser otra cosa: HTML, XML, o un simple carácter como “0” o “1”. Para responder a una petición Ajax no se debe renderizar una vista, sino que basta con un echo en el controlador.</p> <p>Agregar el token CSRF a las peticiones (1/2) Las peticiones enviadas por POST a Laravel deben llevar el token CSRF o serán rechazadas. El token debe agregarse a cada petición, así: $.ajax({ method: “POST”, url: “mi-url”, data: { “_token”: “”, }, …etc… });</p> <p>Agregar el token CSRF a las peticiones (2/2) También puede agregarse automáticamente el token CSRF a todas las peticiones haciendo esto en el header de nuestro layout:</p> <meta name="csrf-token" content="" /> <script type="text/javascript"> $.ajaxSetup({ headers: { 'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content') } }); </script> <p>A partir de ahora, podremos hacer las peticiones Ajax normalmente, porque el token CSRF se añadirá él solito a cada petición Ajax.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
