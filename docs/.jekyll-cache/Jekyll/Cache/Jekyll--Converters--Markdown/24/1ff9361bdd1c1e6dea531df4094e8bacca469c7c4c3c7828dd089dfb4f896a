I"A2<h2 id="85-jsp">8.5. JSP</h2>

<h3 id="851-características-del-lenguaje-jsp">8.5.1. Características del lenguaje JSP</h3>

<p>Fecha de aparición: 1995</p>

<p>Perspectivas:</p>

<ul>
  <li>Usado para proyectos grandes y complejos, donde PHP (y otros lenguajes de scripting) se quedan pequeños. O eso aseguran los chicos de Oracle, claro.</li>
  <li>El lenguaje de programación es Java, es decir, lo conoce cualquier programador.</li>
  <li>Velocidad de ejecución superior a la de otros lenguajes semi-interpretados.</li>
</ul>

<p>Filosofía:</p>

<ul>
  <li>Adaptación natural de Java al lado del servidor.</li>
  <li>Orientado a objetos. Multiplataforma. Fuertemente tipado.</li>
  <li>Puede embeberse dentro de HTML, como PHP.</li>
  <li>El código Java se precompila en un Servlet y se deja cargado en la memoria del servidor. Las peticiones subsiguientes se ejecutan así de forma más rápida. Este enfoque está siendo adoptado por otras tecnologías del lado del servidor, como NodeJS o algunos frameworks basados en otros lenguajes, que <em>precompilan</em> las vistas para servirlas mucho más deprisa.</li>
</ul>

<h3 id="852-configuración-necesaria-en-el-servidor">8.5.2. Configuración necesaria en el servidor</h3>

<p>Para ejecutar Java en el lado del servidor, lo más apropiado es instalar Tomcat. Es el servidor de referencia para la tecnología JSP.</p>

<p>Apache Tomcat es un servidor web capaz de contener y servir los servlets de Java. Implementa todos los servicios necesarios para que JSP funcione correctamente. Existen otros servidores, como JBoss o Embarcadero, pero Tomcat continúa siendo el más extendido en la actualidad. Como se ejecuta sobre la máquina virtual de Java, es posible hacerlo funcionar en cualquier sistema operativo.</p>

<p>Otras soluciones, como ejecutar JSP a través de CGI en un servidor web convencional, son técnicamente viables pero resultan mucho más lentas.</p>

<h3 id="853-sintaxis-básica-de-jsp">8.5.3. Sintaxis básica de JSP</h3>

<p>El código JSP se embebe en HTML de este modo:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>...<span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    Este texto se ha generado desde HTML<span class="nt">&lt;br/&gt;</span>
    <span class="nt">&lt;</span><span class="err">%</span>
      <span class="na">out.println</span><span class="err">("</span><span class="na">Y</span> <span class="na">este</span> <span class="na">se</span> <span class="na">ha</span> <span class="na">generado</span> <span class="na">con</span> <span class="na">JSP</span><span class="err">");</span>
    <span class="err">%</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Las variables se declaran como en cualquier programa Java. Por ejemplo:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="kt">var</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
<span class="n">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"La variable var vale "</span> <span class="o">+</span> <span class="kt">var</span><span class="o">);</span>
</code></pre></div></div>

<p>Estos son los operadores más habituales:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">Comparación:</span> <span class="o">&lt;,</span> <span class="o">&gt;,</span> <span class="o">&lt;=,</span> <span class="o">&gt;=,</span> <span class="o">==,</span> <span class="o">!=</span> 
<span class="nl">Asignación:</span> <span class="o">=</span>
</code></pre></div></div>

<p>Y estas son algunas estructuras de control:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="o">(</span><span class="n">condicion</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">Acciones</span><span class="o">;</span>
<span class="o">}</span>

<span class="k">if</span> <span class="o">(</span><span class="n">condicion</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">Acciones</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="o">}</span>
<span class="k">else</span> <span class="o">{</span>
  <span class="nc">Acciones</span><span class="o">-</span><span class="mi">2</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="854-entrada--salida">8.5.4. Entrada / Salida</h3>

<p>La entrada de datos a través de un formulario HTML se hace usando el objeto request, que estará precargado en cualquier Servlet. La salida se puede hacer con un simple System.out.println():</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Leer datos de un formulario:</span>
<span class="n">variable</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"campo"</span><span class="o">);</span>

<span class="c1">// Salida:</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">"cadena"</span> <span class="o">+</span> <span class="n">variable</span> <span class="o">+</span> <span class="s">"cadena2"</span><span class="o">);</span> 
</code></pre></div></div>

<h3 id="855-bibliotecas-clases-y-métodos">8.5.5. Bibliotecas, clases y métodos</h3>

<p>La forma de escribir clases y métodos en JSP es la misma que en Java, como es lógico. No vamos a explicar aquí todas las peculiaridades del lenguaje, que son muchas y pintorescas. Solo recordaremos que, en Java, no pueden existir métodos fuera de las clases, porque es un lenguaje orientado a objetos bastante estricto.</p>

<p>La sintaxis para declarar una clase, sus atributos y sus métodos es esta:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MiClase</span> <span class="kd">extends</span> <span class="nc">ClaseMadre</span> <span class="o">{</span>

   <span class="kd">public</span><span class="o">|</span><span class="kd">private</span><span class="o">|</span><span class="kd">protected</span> <span class="n">tipo</span> <span class="n">atributo</span><span class="o">;</span>

   <span class="kd">public</span><span class="o">|</span><span class="kd">private</span><span class="o">|</span><span class="kd">protected</span> <span class="n">tipo</span> <span class="nf">nombre</span><span class="o">(</span><span class="n">params</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">Acciones</span><span class="o">;</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Cada clase debe ir en un archivo independiente con el mismo nombre que la clase que contiene.</p>

<p>Las clases de Java pueden agruparse en paquetes (<em>packages</em>). La forma de importar un paquete para usar sus clases en nuestro programa es:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">paquete</span><span class="o">;</span>       <span class="c1">// Esto importa el paquete completo</span>
<span class="kn">import</span> <span class="nn">paquete.clase</span><span class="o">;</span> <span class="c1">// Esto importa solo una clase del paquete</span>
</code></pre></div></div>

<p>Pero cuidado, cuando se trabaja con JSP existe una pequeña diferencia en la forma de importar paquetes: en lugar de la sentencia <em>import</em>, se debe emplear una directiva del precompilador. Las directivas son instrucciones para el precompilador de Java que modifican su modo de proceder durante la compilación. Todas las directivas empiezan por el símbolo “@”.</p>

<p>En el caso concreto de la importación de paquetes o clases en un script JSP, la directiva que debemos emplear es:</p>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">import=</span><span class="s">"paquete"</span> <span class="nt">%&gt;</span>
</code></pre></div></div>

<h3 id="856-ejemplo-1-en-jsp-hola-mundo">8.5.6. Ejemplo 1 en JSP: Hola mundo</h3>

<p>&lt;%
   out.println(“&lt;html&gt;&lt;body&gt;”);
   out.println(“&lt;h1&gt;Hola, mundo&lt;/h1&gt;”);
   out.println(“&lt;/body&gt;&lt;/html&gt;”);
%&gt;</p>

<h3 id="857-ejemplo-2-en-jsp-login-con-comprobación-de-email-por-ajax">8.5.7. Ejemplo 2 en JSP: login con comprobación de email por Ajax</h3>

<p>Nuevamente, mostraremos solo el script del lado del sevidor (login.jsp). El código del lado del cliente lo tienes disponible en la sección que dedicamos al lenguaje Perl, donde solo tendrás que cambiar la referencia a “login.pl” por “login.jsp”.</p>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%</span> <span class="nd">@page</span> <span class="kn">import</span><span class="err">="</span><span class="nn">java.sql.*</span><span class="s">"

# Conectamos a la BD
Connection conex = null;
Statement st = null;
Class.forName("</span><span class="n">org</span><span class="o">.</span><span class="na">gjt</span><span class="o">.</span><span class="na">mm</span><span class="o">.</span><span class="na">mysql</span><span class="o">.</span><span class="na">Driver</span><span class="s">");
conex = DriverManager.getConnection("</span><span class="nl">jdbc:mysql:</span><span class="c1">//servidor", "user", "pass");</span>

<span class="err">#</span> <span class="nc">Recuperamos</span> <span class="n">la</span> <span class="n">información</span> <span class="n">del</span> <span class="n">formulario</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"username"</span><span class="o">);</span>
<span class="n">pass</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>

<span class="err">#</span> <span class="nc">Consultamos</span> <span class="n">usuario</span> <span class="n">y</span> <span class="n">contraseña</span> <span class="n">en</span> <span class="n">la</span> <span class="n">base</span> <span class="n">de</span> <span class="n">datos</span>
<span class="n">st</span> <span class="o">=</span> <span class="n">conex</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>
<span class="nc">ResultSet</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="s">"SELECT id FROM users WHERE user = '"</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> 
            <span class="s">"' AND password = '"</span> <span class="o">+</span> <span class="n">pass</span> <span class="o">+</span> <span class="s">"'"</span><span class="o">);</span>

<span class="err">#</span> <span class="nc">Generamos</span> <span class="n">la</span> <span class="n">respuesta</span> <span class="no">JSON</span> <span class="n">para</span> <span class="n">el</span> <span class="n">cliente</span>
<span class="nf">if</span> <span class="o">(</span><span class="n">st</span><span class="o">.</span><span class="na">EOF</span><span class="o">)</span>
   <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"{'error': 'Usuario o contraseña incorrectos'}"</span><span class="o">);</span>
<span class="k">else</span>
   <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"{'success': 'Autenticación correcta', 'userid':"</span><span class="o">+</span> <span class="nc">ResultSet</span><span class="o">.</span><span class="na">getInt</span><span class="o">()</span> <span class="o">+</span> <span class="s">"}"</span><span class="o">);</span>
<span class="n">conex</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="nt">%&gt;</span>
</code></pre></div></div>
:ET