I"å3<h2 id="83-python">8.3. Python</h2>

<h3 id="831-caracter√≠sticas-del-lenguaje-python">8.3.1. Caracter√≠sticas del lenguaje Python</h3>

<p>Fecha de aparici√≥n: 1991</p>

<p>Perspectivas:</p>

<ul>
  <li>Uso creciente.</li>
  <li>Es el sustituto natural de Perl para el desarrollo r√°pido de scripts.</li>
  <li>Tambi√©n usado en grandes proyectos como alternativa a PHP.</li>
  <li>Menos extendido que PHP, pero comunidad con muchos desarrolladores profesionales (mejor relaci√≥n se√±al/ruido)</li>
  <li>Muchas bibliotecas de terceros ‚Üí flexibilidad</li>
</ul>

<p>Filosof√≠a:</p>

<ul>
  <li>Es la versi√≥n ‚Äúlimpia‚Äù de Perl. Pensado para escribir scripts de forma r√°pida y limpia.</li>
  <li>√ânfasis en la legibilidad: Python es casi pseudoc√≥digo (c√≥digo ‚Äúpythonico‚Äù ‚Üí v. ‚ÄúEl Zen de Python‚Äù)</li>
  <li>Interpretado. Tipado din√°mico. Fuertemente tipado.</li>
  <li>Expresiones regulares heredadas de Perl.</li>
  <li>Multiparadigma: imperativo, O.O., funcional.</li>
</ul>

<h3 id="832-configuraci√≥n-necesaria-en-el-servidor">8.3.2. Configuraci√≥n necesaria en el servidor</h3>

<p>Para hacer funcionar Python en un servidor Apache o similar, es necesario:</p>

<ol>
  <li>Instalar el int√©rprete Python (/usr/bin/python). El m√°s extendido es CPhyton.</li>
  <li>Activar los m√≥dulos python y/o cgi de Apache y configurar el handler de Apache para CGI.</li>
  <li>Instalar m√≥dulos adicionales (p. ej: para acceso a bases de datos) si es necesario.</li>
</ol>

<p>Python puede funcionar de forma nativa integrado en Apache o a trav√©s de CGI. Lo primero es m√°s r√°pido; lo segundo, m√°s frecuente.</p>

<h3 id="833-sintaxis-b√°sica-de-python">8.3.3. Sintaxis b√°sica de Python</h3>

<p>Las variables en Python no se declaran obligatoriamente: tienen tipado din√°mico y son locales por defecto.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">varariable</span> <span class="o">=</span> <span class="n">valor</span><span class="p">;</span>
<span class="k">print</span> <span class="s">"La variable var vale %s"</span> <span class="p">(</span><span class="n">variable</span><span class="p">);</span>
</code></pre></div></div>

<p>En Python hay muchos tipos de datos complejos predefinidos: listas, tuplas, diccionarios‚Ä¶</p>

<p>Algunos operadores son:</p>

<ul>
  <li>Comparaci√≥n: &lt;, &gt;, &lt;=, &gt;=, ==, !=</li>
  <li>Asignaci√≥n: =</li>
</ul>

<p>Y estas son algunas estructuras de control. <strong>¬°Cuidado! ¬°El c√≥digo debe indentarse OBLIGATORIAMENTE!</strong> No existen las llaves ({ y }) en Python. ¬°La indentaci√≥n (o sangrado) marca los bloques!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="n">condicion</span><span class="p">:</span>
  <span class="n">Acciones</span>

<span class="k">if</span> <span class="n">condicion</span><span class="p">:</span>
  <span class="n">Acciones</span><span class="o">-</span><span class="mi">1</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">Acciones</span><span class="o">-</span><span class="mi">2</span>
</code></pre></div></div>

<h3 id="834-entrada--salida">8.3.4. Entrada / Salida</h3>

<p>La entrada de datos por teclado puede hacerse con raw_input():</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">variable</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">"Texto"</span><span class="p">)</span>
</code></pre></div></div>

<p>Pero a nosotros nos interesa hacer entrada de datos a trav√©s de un formulario HTML. Esto se hace as√≠:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">cgi</span>
<span class="n">form</span> <span class="o">=</span> <span class="n">cgi</span><span class="p">.</span><span class="n">FieldStorage</span><span class="p">()</span>
<span class="n">campo</span> <span class="o">=</span> <span class="n">form</span><span class="p">[</span><span class="s">"campo"</span><span class="p">].</span><span class="n">value</span>
</code></pre></div></div>

<p>En cuanto a la salida de datos, se usa <strong><em>print</em></strong> con cadenas de formato, seguida de una lista de variables. Cada elemento de la cadena de formato marcado con un % se sustituir√° por una variable de la lista, en el mismo orden en el que est√©n escritas. Por ejemplo:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span> <span class="s">"cadena %s cadena %s ..."</span> <span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">)</span> 
</code></pre></div></div>

<p>El s√≠mbolo %s significa que en esa posici√≥n ir√° un String. Otras posibilidades son %d (enteros) o %f (float). Esta forma de especificar las cadenas de formato est√° directamente tomada del lenguaje C.</p>

<p>En Python existen muchas otras formas de hacer una salida de datos, pero <strong><em>print</em></strong> es lo suficientemente potente como para que puedas utilizarla para cualquier cosa imaginable en una aplicaci√≥n web.</p>

<h3 id="835-bibliotecas-funciones-y-clases">8.3.5. Bibliotecas, funciones y clases</h3>

<p>En Python hay tres niveles de agrupaci√≥n de bibliotecas:</p>

<ul>
  <li>M√≥dulos: un m√≥dulo es un fichero con c√≥digo Python en su interior. Puede ser una clase o un pu√±ado de funciones sueltas, por ejemplo.</li>
  <li>Paquetes (<em>packages</em>): un paquete es un directorio que contiene varios m√≥dulos. Tambi√©n puede contener subpaquetes. Los paquetes se instalan y desinstalan con un gestor de paquetes (como <em>pip</em>, que viene a ser como <em>composer</em> en PHP).</li>
  <li>Bibliotecas (<em>libraries</em>): una biblioteca es cualquier fragmento de c√≥digo reutilizable que se puede incluir en otros proyectos. Las bibliotecas pueden ser paquetes o no. Existe una <em>Python Standard Library</em> que contiene todas las funciones b√°sicas de Python y viene preinstalada con el <em>core</em> del lenguaje.</li>
</ul>

<p>Podemos incluir una librer√≠a en nuestro proyecto Python usando la palabra <em>import</em>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">mi</span><span class="o">-</span><span class="n">librer√≠a</span>
</code></pre></div></div>

<p>Como hemos dicho, dentro de cada m√≥dulo puede haber clases o subrutinas sueltas. Una subrutina (procedimiento o funci√≥n) se declara as√≠ en Python (observa de nuevo como la indentaci√≥n o sangrado es fundamental porque marca el comienzo y final de los bloques de c√≥digo):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">mi</span><span class="o">-</span><span class="n">funcion</span><span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="p">,</span> <span class="n">etc</span><span class="p">):</span>
    <span class="c1"># Aqu√≠ va el c√≥digo de la funci√≥n
</span>    <span class="p">[</span><span class="k">return</span> <span class="n">valor1</span><span class="p">,</span> <span class="n">varlor2</span><span class="p">...]</span>
</code></pre></div></div>

<p>En cuanto a las clases, la sintaxis para declararlas y muy similar a PHP, Java o C++ (recordando que, en Python, no se usan las llaves sino la indentaci√≥n):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    
    <span class="n">un_atributo</span> <span class="o">=</span> <span class="n">valor</span>
    <span class="n">otro_atributo</span> <span class="o">=</span> <span class="n">valor</span>

    <span class="c1"># Esto es un constructor
</span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">un_atributo</span> <span class="o">=</span> <span class="mi">0</span>
 

    <span class="k">def</span> <span class="nf">un_metodo</span><span class="p">(</span><span class="n">par√°metros</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lo_que_sea</span>
</code></pre></div></div>

<h3 id="836-ejemplo-1-en-python-hola-mundo">8.3.6. Ejemplo 1 en Python: Hola mundo</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python
</span><span class="k">print</span> <span class="s">"Content-type: text/html</span><span class="se">\n\n</span><span class="s">"</span>
<span class="k">print</span> <span class="s">"&lt;html&gt;&lt;body&gt;"</span>
<span class="k">print</span> <span class="s">"&lt;h1&gt;Hola, mundo&lt;/h1&gt;"</span>
<span class="k">print</span> <span class="s">"&lt;/body&gt;&lt;/html&gt;"</span>
</code></pre></div></div>

<h3 id="837-ejemplo-2-en-python-login-con-comprobaci√≥n-de-email-por-ajax">8.3.7. Ejemplo 2 en Python: login con comprobaci√≥n de email por Ajax</h3>

<p>Repetimos ahora el ejemplo del login con comprobaci√≥n de usuario y contrase√±a mediante Ajax, pero no mostraremos de nuevo el c√≥digo del formulario ni de la llamada Ajax. Para ver ese c√≥digo, revisa la secci√≥n que dedicamos al lenguaje Perl. All√≠ solo tendr√°s que cambiar el nombre del script (login.pl) por login.py.</p>

<p>El c√≥digo de ese script s√≠ que cambia, claro. Esta es la versi√≥n del mismo escrita en Python:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python
</span>
<span class="kn">import</span> <span class="nn">cgi</span>
<span class="kn">import</span> <span class="nn">MySQLdb</span> 

<span class="c1"># Capturamos los valores del formulario
</span><span class="n">form</span> <span class="o">=</span> <span class="n">cgi</span><span class="p">.</span><span class="n">FieldStorage</span><span class="p">()</span>
<span class="n">usuario</span> <span class="o">=</span> <span class="n">form</span><span class="p">[</span><span class="s">"username"</span><span class="p">].</span><span class="n">value</span><span class="p">;</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">form</span><span class="p">[</span><span class="s">"password"</span><span class="p">].</span><span class="n">value</span><span class="p">;</span>

<span class="k">print</span> <span class="s">"Usuario = "</span><span class="p">,</span> <span class="n">usuario</span><span class="p">,</span> <span class="s">" Pass = "</span><span class="p">,</span> <span class="n">password</span>

<span class="c1"># Lanzamos la consulta contra la base de datos
</span><span class="n">db</span><span class="o">=</span><span class="n">MySQLdb</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'localhost'</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">'yo-que-s√©'</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="s">'vete-a-saber'</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="s">'lo-que-sea'</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">=</span><span class="n">db</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">num_rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT id FROM users WHERE username = '%s' AND password = '%s';"</span><span class="p">,</span> <span class="p">(</span><span class="n">usuario</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
<span class="n">userid</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="n">fetchone</span><span class="p">()</span>

<span class="c1"># Devolvemos el resultado en JSON
</span><span class="k">print</span> <span class="s">"Content-type: application/json</span><span class="se">\n</span><span class="s">"</span>
<span class="k">if</span> <span class="n">num_rows</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
   <span class="k">print</span> <span class="s">"{'error': 'Usuario o contrase√±a incorrectos'}"</span>
<span class="k">else</span><span class="p">:</span>
   <span class="k">print</span> <span class="s">"{'success': 'El usuario y la contrase√±a son v√°lidos', 'userid': '%d'"</span><span class="p">,</span> <span class="n">userid</span>
</code></pre></div></div>
:ET